var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(l,m){return Object.prototype.hasOwnProperty.call(l,m)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(l,m){for(var k=1;k<arguments.length;k++){var h=arguments[k];if(h)for(var e in h)$jscomp.owns(h,e)&&(l[e]=h[e])}return l};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,m,k){l!=Array.prototype&&l!=Object.prototype&&(l[m]=k.value)};$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(l,m,k,h){if(m){k=$jscomp.global;l=l.split(".");for(h=0;h<l.length-1;h++){var e=l[h];e in k||(k[e]={});k=k[e]}l=l[l.length-1];h=k[l];m=m(h);m!=h&&null!=m&&$jscomp.defineProperty(k,l,{configurable:!0,writable:!0,value:m})}};$jscomp.polyfill("Object.assign",function(l){return l||$jscomp.assign},"es6","es3");
$jscomp.polyfill("Array.from",function(l){return l?l:function(m,k,h){k=null!=k?k:function(a){return a};var e=[],g="undefined"!=typeof Symbol&&Symbol.iterator&&m[Symbol.iterator];if("function"==typeof g){m=g.call(m);for(var c=0;!(g=m.next()).done;)e.push(k.call(h,g.value,c++))}else for(g=m.length,c=0;c<g;c++)e.push(k.call(h,m[c],c));return e}},"es6","es3");$jscomp.arrayIteratorImpl=function(l){var m=0;return function(){return m<l.length?{done:!1,value:l[m++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};
$jscomp.makeIterator=function(l){var m="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return m?m.call(l):$jscomp.arrayIterator(l)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(l){function m(){this.batch_=null}function k(c){return c instanceof e?c:new e(function(a,b){a(c)})}if(l&&!$jscomp.FORCE_POLYFILL_PROMISE)return l;m.prototype.asyncExecute=function(c){if(null==this.batch_){this.batch_=[];var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})}this.batch_.push(c)};var h=$jscomp.global.setTimeout;m.prototype.asyncExecuteFunction=function(c){h(c,0)};m.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=
this.batch_;this.batch_=[];for(var a=0;a<c.length;++a){var b=c[a];c[a]=null;try{b()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};m.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var e=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{c(a.resolve,a.reject)}catch(b){a.reject(b)}};e.prototype.createResolveAndReject_=function(){function c(f){return function(d){b||(b=!0,f.call(a,d))}}var a=this,b=!1;
return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};e.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof e)this.settleSameAsPromise_(c);else{a:switch(typeof c){case "object":var a=null!=c;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};e.prototype.resolveToNonPromiseObj_=function(c){var a=void 0;try{a=c.then}catch(b){this.reject_(b);return}"function"==typeof a?
this.settleSameAsThenable_(a,c):this.fulfill_(c)};e.prototype.reject_=function(c){this.settle_(2,c)};e.prototype.fulfill_=function(c){this.settle_(1,c)};e.prototype.settle_=function(c,a){if(0!=this.state_)throw Error("Cannot settle("+c+", "+a+"): Promise already settled in state"+this.state_);this.state_=c;this.result_=a;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var c=0;c<this.onSettledCallbacks_.length;++c)g.asyncExecute(this.onSettledCallbacks_[c]);
this.onSettledCallbacks_=null}};var g=new m;e.prototype.settleSameAsPromise_=function(c){var a=this.createResolveAndReject_();c.callWhenSettled_(a.resolve,a.reject)};e.prototype.settleSameAsThenable_=function(c,a){var b=this.createResolveAndReject_();try{c.call(a,b.resolve,b.reject)}catch(f){b.reject(f)}};e.prototype.then=function(c,a){function b(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(t){d(t)}}:b}var f,d,n=new e(function(a,b){f=a;d=b});this.callWhenSettled_(b(c,f),b(a,d));return n};
e.prototype.catch=function(c){return this.then(void 0,c)};e.prototype.callWhenSettled_=function(c,a){function b(){switch(f.state_){case 1:c(f.result_);break;case 2:a(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?g.asyncExecute(b):this.onSettledCallbacks_.push(b)};e.resolve=k;e.reject=function(c){return new e(function(a,b){b(c)})};e.race=function(c){return new e(function(a,b){for(var f=$jscomp.makeIterator(c),d=f.next();!d.done;d=f.next())k(d.value).callWhenSettled_(a,
b)})};e.all=function(c){var a=$jscomp.makeIterator(c),b=a.next();return b.done?k([]):new e(function(f,d){function c(a){return function(b){e[a]=b;q--;0==q&&f(e)}}var e=[],q=0;do e.push(void 0),q++,k(b.value).callWhenSettled_(c(e.length-1),d),b=a.next();while(!b.done)})};return e},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(l){return l?l:function(m,k,h){var e=this.length||0;0>k&&(k=Math.max(0,e+k));if(null==h||h>e)h=e;h=Number(h);0>h&&(h=Math.max(0,e+h));for(k=Number(k||0);k<h;k++)this[k]=m;return this}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(l,m){this.$jscomp$symbol$id_=l;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:m})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function l(k){if(this instanceof l)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(k||"")+"_"+m++,k)}var m=0;return l}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.iterator;l||(l=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[l]&&$jscomp.defineProperty(Array.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.asyncIterator;l||(l=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(l){$jscomp.initSymbolIterator();l={next:l};l[$jscomp.global.Symbol.iterator]=function(){return this};return l};
$jscomp.iteratorFromArray=function(l,m){$jscomp.initSymbolIterator();l instanceof String&&(l+="");var k=0,h={next:function(){if(k<l.length){var e=k++;return{value:m(e,l[e]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};$jscomp.polyfill("Array.prototype.keys",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(m){return m})}},"es6","es3");
$jscomp.checkStringArgs=function(l,m,k){if(null==l)throw new TypeError("The 'this' value for String.prototype."+k+" must not be null or undefined");if(m instanceof RegExp)throw new TypeError("First argument to String.prototype."+k+" must not be a regular expression");return l+""};
$jscomp.polyfill("String.prototype.repeat",function(l){return l?l:function(m){var k=$jscomp.checkStringArgs(this,null,"repeat");if(0>m||1342177279<m)throw new RangeError("Invalid count value");m|=0;for(var h="";m;)if(m&1&&(h+=k),m>>>=1)k+=k;return h}},"es6","es3");
System.register("app.js","util/gettext.js view/login.js view/social-pair.js view/register.js view/secure.js view/refresh-secure.js view/help.js view/licence.js view/recover.js view/recover-mailcz.js view/veto.js view/veto-pin.js view/veto-done.js view/register-done.js view/tfa.js view/oauth.js view/avatar.js conf.js ui/language.js".split(" "),function(l){function m(a,b){if(x&&x.getId()==a)return x;x&&(x.deactivate(),x=null);return(x=A.filter(function(b){return b.getId()==a})[0])?(x.activate(b),x):
null}var k,h,e,g,c,a,b,f,d,n,p,q,r,t,v,u,z,y,w,B,A,x,C,D,E;l("getView",function(){return x&&x.getId()});l("setView",m);l("init",function(a){Object.assign(w,a);a=w.query;h(document);document.body.dataset&&(document.body.dataset.service=w.service);window.addEventListener("beforeunload",function(a){});if(w.oauth){var b=w.oauth;document.body.dataset&&(document.body.dataset.oauth=b.internal?"internal":"external");try{a.scope&&(b.scope=a.scope[0]),a.state&&(b.state=a.state[0]),-1<B.indexOf(b.client_id)&&
document.body.classList.add("no-register")}catch(F){}}if(b=C("a[data-username]")){var d=b.getAttribute("data-username");d=d.replace(/&/g,"&amp;").replace(/</g,"&lt;");b.innerHTML=k(b.getAttribute("data-locale"),d)}C("#year").innerHTML=(new Date).getFullYear();Array.from(D(".licence-link")).forEach(function(a){return a.href=k("licence.link")});C("a#login-recover").addEventListener("click",function(a){a.preventDefault();var b=-1;Array.from(D("section#login option")).forEach(function(a,d){a.selected&&
(b=d)});a={username:C("section#login input#login-username").value,domainIndex:b};m("recover",a)});"help"==location.search.substring(1)?m("help"):"recover"==w.page&&a.mode&&"mailcz"==a.mode[0]?m("recover-mailcz"):"recover"==w.page?m(w.page,{path:w.path}):"result"==String(a.neznam)?m("social-pair",{type:"neznam",token:a.code[0]}):m(w.page)});return{setters:[function(a){k=a._;h=a.localize},function(a){e=a["default"]},function(a){g=a["default"]},function(a){c=a["default"]},function(b){a=b["default"]},
function(a){b=a["default"]},function(a){f=a["default"]},function(a){d=a["default"]},function(a){n=a["default"]},function(a){p=a["default"]},function(a){q=a["default"]},function(a){r=a["default"]},function(a){t=a["default"]},function(a){v=a["default"]},function(a){u=a["default"]},function(a){z=a["default"]},function(a){y=a["default"]},function(a){w=a["default"]},function(a){}],execute:function(){B=["cb101930f0f062e6bdac66c4dfb2f705608ac0c953302daa","f65cd352d32879fd3025d4428f9a60ce4fa254a2b5451e5a"];
A=[e,g,c,a,b,f,d,n,p,v,q,r,t,u,z,y];x=null;C=function(a){return document.querySelector(a)};D=function(a){return document.querySelectorAll(a)};E=[];document.addEventListener("keypress",function(a){E.push(String.fromCharCode(a.charCode));7<E.length&&E.shift();switch(E.join("")){case "fhtagn3":c.toggleFake();break;case "fbtest!":e.showFacebook()}})}}});System.register("conf.js",[],function(l){return{setters:[],execute:function(){l("default",{tfaRetry:3E3})}}});
System.register("ui/account-history.js",["util/net.js","util/gettext.js"],function(l){var m,k=function(){function h(e,g){for(var c=0;c<g.length;c++){var a=g[c];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(e,g,c){g&&h(e.prototype,g);c&&h(e,c);return e}}();return{setters:[function(h){},function(h){}],execute:function(){m=function(){function h(e){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");
this._node=widget.cloneNode(!0)}k(h,[{key:"getNode",value:function(){return this._node}}]);return h}();l("default",m)}}});
System.register("ui/alert.js",[],function(l){var m,k=function(){function h(e,g){for(var c=0;c<g.length;c++){var a=g[c];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(e,g,c){g&&h(e.prototype,g);c&&h(e,c);return e}}();l("default",function(h,e){return(new m(h,e)).getPromise()});return{setters:[],execute:function(){m=function(){function h(e,g){var c=this;if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");
this.constructor.current&&this.constructor.current.destroy();this.constructor.current=this;this._options=Object.assign({ok:"",cancel:"",className:null},g);this._node=document.createElement("div");this._node.classList.add("alert");this._options.className&&this._node.classList.add(this._options.className);"string"==typeof e?(g=document.createElement("p"),g.innerHTML=e,this._node.appendChild(g)):this._node.appendChild(e);e=document.createElement("div");this._node.appendChild(e);this._options.cancel&&
(this._cancel=document.createElement("button"),this._cancel.classList.add("cancel"),this._cancel.type="submit",this._cancel.appendChild(document.createTextNode(this._options.cancel)),this._cancel.addEventListener("click",this),e.appendChild(this._cancel));this._options.ok&&(this._ok=document.createElement("button"),this._ok.classList.add("ok"),this._ok.type="submit",this._ok.appendChild(document.createTextNode(this._options.ok)),this._ok.addEventListener("click",this),e.appendChild(this._ok));document.body.appendChild(this._node);
document.body.classList.add("alert");this._ok&&this._ok.focus();e=this._node.offsetWidth;g=this._node.offsetHeight;var a=document.body.offsetHeight;e=Math.round(.5*(document.body.offsetWidth-e));g=Math.round(.3*(a-g));this._node.style.left=e+"px";this._node.style.top=g+"px";this._promise=new Promise(function(a,f){c._resolve=a;c._reject=f})}k(h,[{key:"destroy",value:function(){this._ok&&this._ok.removeEventListener("click",this);this._cancel&&this._cancel.removeEventListener("click",this);this._node.parentNode.removeChild(this._node);
document.body.classList.remove("alert");this.constructor.current=null}},{key:"getPromise",value:function(){return this._promise}},{key:"handleEvent",value:function(e){this.destroy();this._resolve(e.target==this._ok)}}]);return h}()}}});
System.register("ui/captcha.js",["util/net.js","util/gettext.js","util/error.js","validators/base.js"],function(l){var m,k,h,e,g,c,a=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}();return{setters:[function(a){m=a},function(a){k=a._},function(a){h=a["default"]},function(a){e=a["default"]}],execute:function(){g=
document.querySelector(".widget-captcha");g.parentNode.removeChild(g);Array.from(g.querySelectorAll("[data-locale]")).forEach(function(a){a.appendChild(document.createTextNode(k(a.getAttribute("data-locale"))))});c=function(){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this._hash="";this._playCount=0;this._node=g.cloneNode(!0);this._image=this._node.querySelector("img");this._play=this._node.querySelector(".play");this._new=this._node.querySelector(".new");
this._input=this._node.querySelector("input");this._play.addEventListener("click",this);this._new.addEventListener("click",this);this._validator=new e(this._input);this._setHash(a)}a(b,[{key:"getNode",value:function(){return this._node}},{key:"getValue",value:function(){return this._input.value}},{key:"getHash",value:function(){return this._hash}},{key:"showError",value:function(){this._validator.show(k("register.captcha.error"));this._getNew()}},{key:"handleEvent",value:function(a){var b=this;switch(a.target){case this._play:8>
this._playCount?this._tryPlay()&&a.preventDefault():(a.preventDefault(),this._getNew().then(function(){return b._tryPlay()}));break;case this._new:a.preventDefault(),this._getNew()}}},{key:"_tryPlay",value:function(){this._playCount++;var a=this._play.href;if(window.Audio)return(new Audio(a)).play(),!0;if(navigator.mimeTypes&&navigator.mimeTypes["audio/wav"]&&navigator.mimeTypes["audio/wav"].enabledPlugin){var b=document.createElement("div");b.innerHTML='<embed type="audio/x-wav" src="'+a+'" hidden="true" autostart="true" style="position:absolute;top:-2000px;left:-2000px;" />';
document.body.appendChild(b);return!0}return!1}},{key:"_getNew",value:function(){var a=this;return m.request("/captcha",{}).then(function(b){return a._setHash(b.hash)},function(a){return h(a)})}},{key:"_setHash",value:function(a){this._playCount=0;this._hash=a;this._image.src="/captcha/image/"+a;this._play.href="/captcha/audio/"+a}}]);return b}();l("default",c)}}});
System.register("ui/email.js",["util/gettext.js","util/net.js","util/error.js","app.js","validators/base.js"],function(l){var m,k,h,e,g,c,a,b=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,f,c){f&&a(b.prototype,f);c&&a(b,c);return b}}();return{setters:[function(a){m=a._;k=a.localize},function(a){h=a},function(a){e=a["default"]},function(a){},function(a){g=
a["default"]}],execute:function(){c=document.querySelector("form.widget-secure-email");c.parentNode.removeChild(c);k(c);a=function(){function a(b){var d=this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this._node=c.cloneNode(!0);this._node.addEventListener("submit",this);this._value=null;this._state="";this._options=Object.assign({onStateChange:function(){},refresh:!1},b);this._dom={email:this._node.querySelector("input"),notice:this._node.querySelector("[data-state='sent'] p"),
value:this._node.querySelector("[data-state='done'] p")};this._validators={email:new g(this._dom.email,this._dom.email)};this._node.querySelector("[data-state='inactive'] a").addEventListener("click",function(a){a.preventDefault();d.activate()});this._node.querySelector("a.edit").addEventListener("click",function(a){a.preventDefault();d.setState("email")});this._node.querySelector("a.other").addEventListener("click",function(a){a.preventDefault();d.setState("email")});this._node.querySelector("a.resend").addEventListener("click",
function(a){a.preventDefault();d._sendConfirmation()});this.setState("inactive")}b(a,[{key:"setValue",value:function(a){this._value=a;this.setState("done")}},{key:"activate",value:function(){this.setState("email")}},{key:"getNode",value:function(){return this._node}},{key:"getState",value:function(){return this._state}},{key:"handleEvent",value:function(a){a.preventDefault();this._sendConfirmation()}},{key:"_sendConfirmation",value:function(){var a=this,b=this._dom.email.value.trim();b?(this._value=
b,h.request("/user/verification_email",{email:this._value,refresh:this._options.refresh},{method:"POST"}).then(function(b){return a.setState("sent")},function(b){return a._emailError(b)})):this._validators.email.show(m("register.validation.username.empty"))}},{key:"setState",value:function(a){if(a!=this._state){this._state=a;Array.from(this._node.querySelectorAll("[data-state]")).forEach(function(b){b.classList[b.getAttribute("data-state")==a?"remove":"add"]("hidden")});switch(a){case "sent":this._validators.email.hide();
this._dom.notice.innerHTML=m("secure.email.sent","<strong>"+this._value+"</strong>");break;case "done":var b=m("secure.email.done","<strong>"+this._value+"</strong>");this._dom.value.innerHTML=b}this._options.onStateChange(this._state)}}},{key:"_emailError",value:function(a){if(a instanceof h.HTTPError&&400==a.status)switch(a.response.status){case 486:this._validators.email.show(m("register.validation.username.malformed"));break;case 469:this._validators.email.show(m("register.validation.username.same"));
break;case 404:case 422:this._validators.email.show(m("recover.validation.email"));break;default:e(a)}else e(a)}}]);return a}();l("default",a)}}});
System.register("ui/imagecrop.js",[],function(l){var m,k=function(){function h(e,g){for(var c=0;c<g.length;c++){var a=g[c];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(e,g,c){g&&h(e.prototype,g);c&&h(e,c);return e}}();return{setters:[],execute:function(){m=function(){function h(e,g,c){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");this._type=c;this._cropperSize=0;this._cropperPos=[0,
0];this._mousePos=[0,0];this._dragAction="";this._scale=1;this._handlersWrap=this._node=null;this._canvases={source:null,result:null,tmp:null};this._build(g||document.body);g=new Image;g.addEventListener("load",this);g.src=e}k(h,[{key:"crop",value:function(){var e=document.createElement("canvas"),g=this._cropperSize/this._scale,c=Math.min(g,512);["width","height"].forEach(function(a){return e[a]=c});e.getContext("2d").drawImage(this._canvases.source,this._cropperPos[0]/this._scale,this._cropperPos[1]/
this._scale,g,g,0,0,c,c);g=this._type.match(/png$/i)?this._type:"image/jpeg";return e.toDataURL(g)}},{key:"destroy",value:function(){this._node.parentNode.removeChild(this._node)}},{key:"handleEvent",value:function(e){switch(e.type){case "load":this._createSource(e.target);this._init();break;case "click":this._rotate();break;case "touchstart":e.preventDefault(),e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY;case "mousedown":this._dragStart(e);break;case "touchend":case "mouseup":document.removeEventListener("mousemove",
this);document.removeEventListener("mouseup",this);document.removeEventListener("touchmove",this);document.removeEventListener("touchend",this);break;case "touchmove":e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY;case "mousemove":switch(this._dragAction){case "move":this._move(e);break;default:this._resize(e)}}}},{key:"_createSource",value:function(e){var g=this._canvases.source;["width","height"].forEach(function(c){return g[c]=e[c]});g.getContext("2d").drawImage(e,0,0)}},{key:"_init",
value:function(){var e=this._canvases.source,g=this._canvases.tmp,c=this._canvases.result;this._scale=this._getScale();var a=e.width*this._scale,b=e.height*this._scale;[g,c].forEach(function(f){f.width=Math.floor(a);f.height=Math.floor(b)});this._cropperSize=Math.round(.5*Math.min(a,b));this._cropperPos=[Math.round(c.width/2-this._cropperSize/2),Math.round(c.height/2-this._cropperSize/2)];this._draw()}},{key:"_rotate",value:function(){var e=this._canvases.source,g=document.createElement("canvas");
g.width=e.height;g.height=e.width;var c=g.getContext("2d");c.translate(g.width/2,g.height/2);c.rotate(Math.PI/2);c.translate(-e.width/2,-e.height/2);c.drawImage(e,0,0);this._canvases.source=g;this._init()}},{key:"_getScale",value:function(){return Math.min(1,this._node.offsetWidth/this._canvases.source.width)}},{key:"_build",value:function(e){var g=this;this._node=document.createElement("div");this._node.className="image-crop";for(var c in this._canvases)this._canvases[c]=document.createElement("canvas");
this._handlersWrap=document.createElement("div");["top","bottom"].forEach(function(a){["left","right"].forEach(function(b){var f=document.createElement("span");f.className=a+"-"+b;g._handlersWrap.appendChild(f)})});this._handlersWrap.addEventListener("mousedown",this);this._handlersWrap.addEventListener("touchstart",this);c=document.createElement("button");c.type="button";c.innerHTML="\u21bb";c.addEventListener("click",this);this._node.appendChild(c);this._node.appendChild(this._canvases.result);
this._node.appendChild(this._handlersWrap);e.parentNode.insertBefore(this._node,e.nextSibling)}},{key:"_draw",value:function(){this._restrainCropper();var e=this._canvases.source,g=this._canvases.tmp,c=this._canvases.result,a=g.getContext("2d"),b=c.getContext("2d");a.globalCompositeOperation="source-out";a.clearRect(0,0,g.width,g.height);b.clearRect(0,0,c.width,c.height);a.fillStyle="rgba(0,0,0,0.5)";a.fillRect(0,0,g.width,g.height);a.globalCompositeOperation="destination-out";a.fillStyle="rgba(0,0,0,1)";
a.strokeRect(this._cropperPos[0]+.5,this._cropperPos[1]+.5,this._cropperSize,this._cropperSize);a.beginPath();a.arc(this._cropperPos[0]+this._cropperSize/2,this._cropperPos[1]+this._cropperSize/2,this._cropperSize/2,0,2*Math.PI);a.closePath();a.fill();a=e.width*this._scale;var f=e.height*this._scale;b.drawImage(e,(c.width-a)/2,(c.height-f)/2,a,f);b.drawImage(g,0,0);this._handlersWrap.style.width=this._cropperSize+"px";this._handlersWrap.style.height=this._cropperSize+"px";this._handlersWrap.style.left=
this._cropperPos[0]+c.offsetLeft+"px";this._handlersWrap.style.top=this._cropperPos[1]+c.offsetTop+"px"}},{key:"_dragStart",value:function(e){this._dragAction=e.target==this._handlersWrap?"move":"resize-"+e.target.className;this._mousePos=[e.clientX,e.clientY];document.addEventListener("mousemove",this);document.addEventListener("mouseup",this);document.addEventListener("touchmove",this);document.addEventListener("touchend",this)}},{key:"_resize",value:function(e){var g=e.clientX-this._mousePos[0],
c=e.clientY-this._mousePos[1],a=void 0;this._mousePos=[e.clientX,e.clientY];switch(this._dragAction){case "resize-top-left":a=this._getDistance(-g,-c);this._cropperPos[0]-=a;this._cropperPos[1]-=a;break;case "resize-top-right":a=this._getDistance(g,-c);this._cropperPos[1]-=a;break;case "resize-bottom-right":a=this._getDistance(g,c);break;case "resize-bottom-left":a=this._getDistance(-g,c),this._cropperPos[0]-=a}this._cropperSize+=a;this._draw()}},{key:"_move",value:function(e){this._cropperPos=[this._cropperPos[0]+
e.clientX-this._mousePos[0],this._cropperPos[1]+e.clientY-this._mousePos[1]];this._mousePos=[e.clientX,e.clientY];this._draw()}},{key:"_restrainCropper",value:function(){var e=this._canvases.result;this._cropperSize=Math.min(e.width,e.height,this._cropperSize);this._cropperSize=Math.max(this._cropperSize,20);this._cropperPos[0]=Math.max(0,this._cropperPos[0]);this._cropperPos[1]=Math.max(0,this._cropperPos[1]);this._cropperPos[0]=Math.min(this._cropperPos[0],e.width-this._cropperSize);this._cropperPos[1]=
Math.min(this._cropperPos[1],e.height-this._cropperSize)}},{key:"_getDistance",value:function(e,g){return Math.max(e,g)}}]);return h}();l("default",m)}}});
System.register("ui/language.js",["util/net.js","util/error.js"],function(l){var m,k,h,e,g=function(){function c(a,b){for(var f=0;f<b.length;f++){var d=b[f];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,b,f){b&&c(a.prototype,b);f&&c(a,f);return a}}();return{setters:[function(c){m=c},function(c){k=c["default"]}],execute:function(){h=function(c){return document.querySelectorAll(c)};e=function(){function c(){var a=this;
if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");Array.from(h("[data-language]")).forEach(function(b){b.addEventListener("click",function(f){return a._set(b.getAttribute("data-language"))})});if(this._node=document.querySelector("#language"))this._node.addEventListener("click",this),document.addEventListener("click",this)}g(c,[{key:"handleEvent",value:function(a){var b=this._node.querySelector("ul");a.currentTarget==this._node?(b.classList.toggle("hidden"),a.stopPropagation()):
b.classList.add("hidden")}},{key:"_set",value:function(a){m.request("/user/properties/lang",{lang:a}).then(function(){location.reload()},k)}}]);return c}();l("default",new e)}}});
System.register("ui/loader.js",[],function(l){var m,k;l("start",function(){m||setTimeout(function(){m&&(k.classList.remove("hidden"),k.style.transition="",k.style.width=0,k.offsetWidth,k.style.transition="all 3s cubic-bezier(.15, .9, .15, .9)",k.style.width="100%")},250);m++});l("stop",function(){m--;m||k.classList.add("hidden")});return{setters:[],execute:function(){m=0;k=document.createElement("div");k.id="loader";document.body.appendChild(k);k.classList.add("hidden")}}});
System.register("ui/password-changer.js","util/net.js util/gettext.js conf.js util/error.js validators/nonempty.js validators/passwordmatch.js validators/password.js ui/phone-username.js".split(" "),function(l){var m,k,h,e,g,c,a,b,f,d,n,p=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}();return{setters:[function(a){m=
a},function(a){k=a._;h=a.localize},function(a){e=a["default"]},function(a){g=a["default"]},function(a){c=a["default"]},function(b){a=b["default"]},function(a){b=a["default"]},function(a){f=a["default"]}],execute:function(){d=document.querySelector(".widget-password-change");d.parentNode.removeChild(d);h(d);n=function(){function n(r){var g=this;if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this._options=Object.assign({"continue":!1,username:!1,phone:!1,currentPlaceholder:k("password.current"),
newPlaceholder:k("password.new"),repeatPlaceholder:k("password.repeat"),submit:k("password.submit"),savedPhone:"",url:"/user/properties/password",formatData:function(a,b){return{old_password:a,new_password:b,service:e.service}},text:"",onContinue:function(){},onSuccess:function(){}},r);this._node=d.cloneNode(!0);this._node.addEventListener("submit",this);this._submit=this._node.querySelector("[type=submit]");this._submit.innerHTML=this._options.submit;this._passwords=Array.from(this._node.querySelectorAll("input[type=password]"));
this._passwords[0].placeholder=this._options.currentPlaceholder;this._passwords[1].placeholder=this._options.newPlaceholder;this._passwords[2].placeholder=this._options.repeatPlaceholder;this._validators={old:new c(this._passwords[0]),password:new b(this._passwords[1],this._options.username),match:new a(this._passwords[2],this._passwords.slice(1))};r=this._node.querySelector("h3");r.innerHTML="";r.appendChild(document.createTextNode(k("password."+("forced"==this._options.text?"title_forced":"title"))));
this._options.text&&(this._node.querySelector("p").innerHTML=k("password.text."+this._options.text));r=this._node.querySelector(".continue");r.classList.toggle("hidden",!this._options["continue"]);r.addEventListener("click",function(a){a.preventDefault();g._options.onContinue()});this._options.phone&&(this._phone=new f(this._options.username,{onStateChange:function(a){return g.setReady("pin"==a)},onSubmit:function(){return g._doSubmit()}}),this._options.savedPhone&&this._phone.setPhone(this._options.savedPhone),
this._node.replaceChild(this._phone.getNode(),this._node.querySelector(".placeholder")),this._validators.pin=new c(this._phone.getNode().querySelector("[data-state='pin'] input.pin")),this._phone.activate(),this.setReady(!1))}p(n,[{key:"getNode",value:function(){return this._node}},{key:"handleEvent",value:function(a){a.target==this._node&&(a.preventDefault(),this._doSubmit())}},{key:"setReady",value:function(a){this._submit.disabled=!a}},{key:"_doSubmit",value:function(){var a=this,b=Object.keys(this._validators).map(function(b){return a._validators[b].validate(!0)});
Promise.all(b).then(function(b){b.every(function(a){return a})&&(Object.keys(a._validators).forEach(function(b){return a._validators[b].hide()}),a._phone&&a._phone.clearErrors(),a._setPassword())})}},{key:"_setPassword",value:function(){var a=this,b={method:"PUT"},d=this._options.formatData(this._passwords[0].value,this._passwords[1].value),f=this._options.url;this._options.username&&(d.username=this._options.username);this._options.phone&&(d.pin=this._phone.getPIN(),this._options.savedPhone||(d.phone=
this._phone.getPhone()),f="/user/unblock",b.method="POST");this._submit.disabled=!0;m.request(f,d,b).then(function(b){return a._options.onSuccess()},function(b){return a._passwordError(b)}).then(function(){a._submit.disabled=!1})}},{key:"_passwordError",value:function(a){a instanceof m.HTTPError&&400==a.status&&this._knownPasswordError(a.response.status)||g(a)}},{key:"_knownPasswordError",value:function(a){switch(a){case 401:this._validators.old.show(k("password.validation.old"));break;case 456:this._validators.password.show(k("register.validation.password.many_changes"));
break;case 472:this._phone.getWarning().show(k("secure.validation.phone.too_many_guesses"));break;case 473:this._phone.getWarning().show(k("secure.validation.phone.bad_pin"));break;case 492:this._validators.password.show(k("register.validation.password.historic"));break;case 493:this._validators.password.show(k("register.validation.password.similar"));break;case 496:this._validators.password.show(k("register.validation.password.weak"));break;default:return!1}return!0}}]);return n}();l("default",n)}}});
System.register("ui/phone.js","util/gettext.js util/net.js util/html.js util/error.js validators/phone.js validators/base.js".split(" "),function(l){var m,k,h,e,g,c,a,b,f,d=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}();return{setters:[function(a){m=a._;k=a.localize},function(a){h=a},function(a){e=a},function(a){g=
a["default"]},function(a){c=a["default"]},function(b){a=b["default"]}],execute:function(){b=document.querySelector("form.widget-secure-phone");b.parentNode.removeChild(b);k(b);f=function(){function f(d){var e=this;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this._node=b.cloneNode(!0);this._node.addEventListener("submit",this);this._value=null;this._state="";this._options=Object.assign(this._defaultOptions(),d);this._dom={pin:this._node.querySelector("[data-state='pin'] input.pin"),
repeat:this._node.querySelector("[data-state='pin'] .repeat"),description2:this._node.querySelector("[data-state='pin'] .description2"),password:this._node.querySelector("[data-state='pin'] input.password"),value:this._node.querySelector("[data-state='done'] p")};this._options.cachedPassword&&(this._dom.password.style.display="none");d=this._node.querySelector("[data-state='phone'] input");this._validators={phone:new c(d,d),pin:new a(this._dom.pin,this._dom.pin),password:new a(this._dom.password,
this._dom.password)};this._node.querySelector("[data-state='inactive'] a").addEventListener("click",function(a){a.preventDefault();e.activate("phone")});this._node.querySelector("a.edit").addEventListener("click",function(a){a.preventDefault();e.setState("phone")});this._other=this._node.querySelector("a.other");this._other.addEventListener("click",function(a){a.preventDefault();e.setState("phone")});this._node.querySelector("a.resend").addEventListener("click",function(a){a.preventDefault();e._requestPIN()});
this.setState("inactive")}d(f,[{key:"_defaultOptions",value:function(){return{onStateChange:function(){},refresh:!1}}},{key:"setValue",value:function(a){this._value=a;this.setState("done")}},{key:"activate",value:function(){this.setState("phone")}},{key:"getNode",value:function(){return this._node}},{key:"getPIN",value:function(){return this._dom.pin.value}},{key:"getWarning",value:function(){return this._validators.pin}},{key:"getState",value:function(){return this._state}},{key:"handleEvent",value:function(a){a.preventDefault();
switch(this._state){case "phone":this._checkAndRequestPIN();break;case "pin":this._sendPIN()}}},{key:"_checkAndRequestPIN",value:function(){var a=this;this._validators.phone.validate(!0).then(function(b){b&&(a._value=a._validators.phone.extractNumber(),a._requestPIN())})}},{key:"_requestPIN",value:function(){var a=this;h.request("/user/pin/"+this._value,{},{method:"POST"}).then(function(b){return a.setState("pin")},function(b){return a._phoneError(b)})}},{key:"_sendPIN",value:function(){var a=this;
this.clearErrors();var b={pin:this._dom.pin.value,phone:this._value,password:this._options.cachedPassword||this._dom.password.value||"",refresh:this._options.refresh};b.password?h.request("/user/verified_phone",b,{method:"POST"}).then(function(b){a.clearErrors();a.setState("done")},function(b){b instanceof h.HTTPError&&400==b.status?473==b.response.status?a._validators.pin.show(m("secure.validation.phone.bad_pin")):472==b.response.status?a._validators.phone.show(m("secure.validation.phone.too_many_guesses")):
401==b.response.status?a._validators.password.show(m("secure.validation.phone.bad_password")):g(b):g(b)}):this._validators.password.show(m("login.validation.emptyPassword"))}},{key:"_anonNumber",value:function(a){a=a.toString();return this._fakePhone?a+"\u2026":a.slice(0,-3)+"\u2026"}},{key:"setState",value:function(a){if(a!=this._state){this._state=a;this._validators.phone.hide();Array.from(this._node.querySelectorAll("[data-state]")).forEach(function(b){b.classList[b.getAttribute("data-state")==
a?"remove":"add"]("hidden")});switch(a){case "pin":e.clear(this._dom.repeat);var b=this._anonNumber(this._value);this._dom.repeat.appendChild(document.createTextNode(b));e.clear(this._dom.description2);b=m("secure.pin."+(this._options.cachedPassword?"description2b":"description2a"));this._dom.description2.appendChild(document.createTextNode(b));this._fakePhone&&this._other.classList.add("hidden");break;case "done":b=m("secure.phone.done","<strong>"+this._value+"</strong>"),this._dom.value.innerHTML=
b}this._options.onStateChange(this._state)}}},{key:"clearErrors",value:function(){for(var a in this._validators)this._validators[a].hide()}},{key:"_phoneError",value:function(a){a instanceof h.HTTPError&&400==a.status?this._knownPhoneError(a.response):g(a)}},{key:"_knownPhoneError",value:function(a){switch(a.status){case 455:this._validators.phone.show(m("secure.validation.phone.sms_fail"));break;case 465:this._validators.phone.show(m("secure.validation.phone.sms_delay"));break;case 443:case 481:this._validators.phone.show(m("secure.validation.phone.too_many"))}}}]);
return f}();l("default",f)}}});
System.register("ui/phone-username.js",["./phone.js","util/net.js"],function(l){function m(c,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);c.prototype=Object.create(a&&a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?Object.setPrototypeOf(c,a):c.__proto__=a)}var k,h,e,g=function(){function c(a,b){for(var f=0;f<b.length;f++){var d=b[f];d.enumerable=d.enumerable||
!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,b,f){b&&c(a.prototype,b);f&&c(a,f);return a}}();return{setters:[function(c){k=c["default"]},function(c){h=c}],execute:function(){e=function(c){function a(b,f){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");a:{var d=Object.getPrototypeOf(a.prototype),c="constructor";var e=this;var g=!0;for(;g;)if(null===d&&(d=Function.prototype),g=Object.getOwnPropertyDescriptor(d,
c),void 0===g){d=Object.getPrototypeOf(d);if(null===d)break;g=!0}else{if("value"in g){e=g.value;break a}c=g.get;e=void 0===c?void 0:c.call(e);break a}e=void 0}e.call(this,f);this._username=b;this._fakePhone=!1}m(a,c);g(a,[{key:"setPhone",value:function(a){this._value=a;this._fakePhone=!0;var b=this.getNode().querySelector("[data-state='phone'] input");b.value=a+"\u2026";b.disabled=!0}},{key:"getPIN",value:function(){return this._dom.pin.value}},{key:"getPhone",value:function(){return this._value}},
{key:"_defaultOptions",value:function(){return{onStateChange:function(){},onSubmit:function(){}}}},{key:"_checkAndRequestPIN",value:function(){var a=this;this._fakePhone?this._requestPIN():this._validators.phone.validate(!0).then(function(b){b&&(a._value=a._validators.phone.extractNumber(),a._requestPIN())})}},{key:"_requestPIN",value:function(){var a=this,f={username:this._username};this._fakePhone||(f.phone=this._value);h.request("/username/pin",f,{method:"POST"}).then(function(b){return a.setState("pin")},
function(b){return a._phoneError(b)})}},{key:"_sendPIN",value:function(){this._options.onSubmit()}}]);return a}(k);l("default",e)}}});
System.register("ui/secure.js",["util/error.js","util/net.js","./phone.js","./email.js"],function(l){var m,k,h,e,g,c=function(){function a(a,f){for(var b=0;b<f.length;b++){var c=f[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,f,d){f&&a(b.prototype,f);d&&a(b,d);return b}}();return{setters:[function(a){m=a["default"]},function(a){k=a},function(a){h=a["default"]},function(a){e=a["default"]}],execute:function(){g=function(){function a(b){var f=
this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this._options=Object.assign({onStateChange:function(a,b){},refresh:!1},b);this._node=document.createElement("div");this._node.classList.add("widget-secure");this._email=new e({onStateChange:function(a){return f._stateChange("email",a)},refresh:this._options.refresh});this._phone=new h({onStateChange:function(a){return f._stateChange("phone",a)},refresh:this._options.refresh});this._node.appendChild(this._phone.getNode());
this._node.appendChild(this._email.getNode());this.reset()}c(a,[{key:"reset",value:function(){var a=this;k.request("/user",null,{method:"GET"}).then(function(b){return a._userData(b)},m)}},{key:"getNode",value:function(){return this._node}},{key:"_userData",value:function(a){var b=a.verified_phone,d=a.verified_email;b&&this._phone.setValue(b);d&&this._email.setValue(d);b||d||this._phone.activate();a=a.domainFlags;a=!a.official&&!a.mx;this._email.getNode().style.display=a?"none":""}},{key:"_moveUp",
value:function(a){var b=this;("phone"==a?[this._phone,this._email]:[this._email,this._phone]).forEach(function(a){return b._node.appendChild(a.getNode())})}},{key:"_moveDown",value:function(a){this._moveUp("phone"==a?"email":"phone")}},{key:"_stateChange",value:function(a,f){if(this._phone&&this._email){switch(f){case "done":this._node.classList.add("done");this._moveUp(a);break;case "inactive":this._moveDown(a);break;default:this._node.classList.remove("done"),a="phone"==a?this._email:this._phone,
f=a.getState(),"inactive"!=f&&"done"!=f&&a.setState("inactive")}a=this._email.getState();f=this._phone.getState();this._options.onStateChange(a,f)}}}]);return a}();l("default",g)}}});
System.register("ui/tfa.js","util/tfa-loop.js util/error.js ui/alert.js conf.js util/gettext.js util/net.js util/html.js".split(" "),function(l){function m(b,f){function c(){var d=Date.now();d=Math.max(0,f-Math.round((d-e)/1E3));var g=Math.floor(d/60)+":"+Math.floor(d%60).toString().lpad();n.innerHTML=a(b,g);0<d&&setTimeout(c,1E3)}var e=Date.now(),n=d.node("p");c();return g(n,{ok:"OK"})}function k(){if(c.oauth){var a=c.return_url,b={error:"tfa-denied"};c.oauth.state&&(b.state=c.oauth.state);var d=
[],f;for(f in b)d.push([f,b[f]].map(encodeURIComponent).join("="));return a+(-1<a.indexOf("?")?"&":"?")+d.join("&")}return"/"}var h,e,g,c,a,b,f,d,n,p,q,r=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}();return{setters:[function(a){h=a["default"]},function(a){e=a["default"]},function(a){g=a["default"]},function(a){c=
a["default"]},function(d){a=d._;b=d.localize},function(a){f=a},function(a){d=a}],execute:function(){n=document.querySelector(".widget-tfa");n.parentNode.removeChild(n);b(n);p={pin:!1,onAllow:function(){}};q=function(){function b(a){var d=this;if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this._options=Object.assign({},p,a);this._helpVisible=!1;this._node=n.cloneNode(!0);this._help=this._node.querySelector(".help");this._help.parentNode.removeChild(this._help);this._node.querySelector("[data-action=pin]").addEventListener("submit",
function(a){a.preventDefault();d._submitPin(a.target)});Array.from(this._node.querySelectorAll("[data-action=help]")).forEach(function(a){a.addEventListener("click",function(a){a.preventDefault();d._toggleHelp(a.target)})});this._help.querySelector("[data-action=sms]").addEventListener("click",function(a){a.preventDefault();a=a.currentTarget;a.classList.contains("disabled")||d._sendSMS(a)});this._help.querySelector("[data-action=push]").addEventListener("click",function(a){a.preventDefault();d._sendPush()});
this._loop=this._startWaiting(a)}r(b,[{key:"getNode",value:function(){return this._node}},{key:"_toggleHelp",value:function(a){var b=this._help;this._helpVisible?(this._helpVisible=!1,b.parentNode.removeChild(b)):(this._helpVisible=!0,b.style.transform="scale(1, 0)",a.parentNode.insertBefore(b,a.nextSibling),b.offsetWidth,b.style.transform="scale(1, 1)")}},{key:"_startWaiting",value:function(a){var b=this,d=new h;d.onAllow=function(a){b._node.classList.add("hidden");b._options.onAllow(a)};d.onDeny=
function(){location.href=k()};d.onError=function(a){return b._handleError(a)};a.pin?this._showSection("pin"):this._showSection("waiting");return d}},{key:"_showSection",value:function(a){Array.from(this._node.querySelectorAll("section")).forEach(function(b){b.style.display=b.classList.contains(a)?"":"none"});if("pin"==a){var b=this._node.querySelector("form [name=pin]");b.value="";b.focus()}if("waiting"==a){b=this._node.querySelector(".video");var f=d.node("video",{loop:!0,autoplay:!0});f.setAttribute("playsinline",
"playsinline");f.src="/static/img/tfa/tfa"+(1<(window.devicePixelRatio||1)?600:300)+".mp4";b.appendChild(f)}}},{key:"_sendPush",value:function(){var b=this;this._loop.push().then(function(d){b._toggleHelp();g(a("tfa.help.pushSent"),{ok:"OK"})},function(a){return b._handleError(a)})}},{key:"_sendSMS",value:function(a){var b=this;a.classList.add("disabled");setTimeout(function(){return a.classList.remove("disabled")},1E3);this._loop.sms().then(function(a){b._toggleHelp();b._showSection("pin")},function(a){return b._handleError(a)})}},
{key:"_submitPin",value:function(a){var b=this;a=a.querySelector("[name=pin]").value;this._loop.pin(a).then(function(a){return b._showSection("waiting")},function(a){return b._handleError(a)})}},{key:"_handleError",value:function(b){if(b instanceof f.HTTPError&&400==b.status)switch(b.response.status){case 404:location.href=k();return;case 447:return m("tfa.help.smsWait",b.response.payload.remain);case 465:return g(a("secure.validation.phone.sms_delay"),{ok:"OK"});case 473:return g(a("secure.validation.phone.bad_pin"),
{ok:"OK"});case 443:case 481:return g(a("secure.validation.phone.too_many"),{ok:"OK"})}e(b)}}]);return b}();l("default",q)}}});
System.register("ui/vcard.js",[],function(l){var m,k,h=function(){function e(e,c){for(var a=0;a<c.length;a++){var b=c[a];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(e,b.key,b)}}return function(g,c,a){c&&e(g.prototype,c);a&&e(g,a);return g}}();return{setters:[],execute:function(){m=document.querySelector("div.widget-vcard");m.parentNode.removeChild(m);k=function(){function e(g,c){var a=2>=arguments.length||void 0===arguments[2]?null:arguments[2],
b=3>=arguments.length||void 0===arguments[3]?null:arguments[3];if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");g=g.trim();this.node=m.cloneNode(!0);this._avatar=this.node.querySelector("img");this._name=this.node.querySelector("p.name");this._email=this.node.querySelector("p.email");this._tick=null;a?this._avatar.src=a:this._avatar.style.visibility="hidden";g||(g=c.match(/^[^@]+/));this._name.appendChild(document.createTextNode(g));this._email.appendChild(document.createTextNode(c));
b&&b.parentNode.insertBefore(this.node,b)}h(e,null,[{key:"fromBadge",value:function(e){var c=new this(e.name,e.email,e.avatar_url);"orange"==e.state&&c.node.classList.add("orange");return c}}]);h(e,[{key:"destroy",value:function(){this.node.parentNode.removeChild(this.node)}}]);return e}();l("default",k)}}});
System.register("util/error.js",["./net.js","util/gettext.js","ui/alert.js"],function(l){var m,k,h;l("default",function(e){window.console&&console.error&&console.error(e);var g={ok:k("alert.ok")};switch(!0){case e instanceof m.HTTPError:if(400==e.status&&401==e.response.status){location.reload();break}h(e.status+": "+e.message,g);break;case e instanceof m.TimeoutError:case e instanceof m.AbortError:h(e.message,g);break;case e instanceof m.NetworkError:h(k("alert.network"),g);break;case "string"==
typeof e:h(e,g);break;default:h("Generic JS exception: "+e.message,g)}});return{setters:[function(e){m=e},function(e){k=e._},function(e){h=e["default"]}],execute:function(){}}});
System.register("util/events.js",[],function(l){var m,k=function(){function h(e,g){for(var c=0;c<g.length;c++){var a=g[c];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(e,g,c){g&&h(e.prototype,g);c&&h(e,c);return e}}();return{setters:[],execute:function(){m=function(){function h(e){var g=1>=arguments.length||void 0===arguments[1]?500:arguments[1];if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");
this._parent=e;this._data={mouse:[],key:[]};this._limit=g;this._now=Date.now();this._props={type:"t",clientX:"x",clientY:"y",button:"b",keyCode:"key",charCode:"char"};document.addEventListener("mousedown",this);document.addEventListener("mousemove",this);document.addEventListener("mouseup",this);document.addEventListener("keydown",this);document.addEventListener("keypress",this);document.addEventListener("keyup",this)}k(h,[{key:"handleEvent",value:function(e){var g={ts:(new Date).getTime()-this._now};
for(c in this._props)c in e&&(g[this._props[c]]=e[c]);e=this._data[-1==e.type.indexOf("mouse")?"key":"mouse"];e.push(g);if("x"in g){var c=this._parent.getBoundingClientRect();g.x=Math.round(g.x-c.left);g.y=Math.round(g.y-c.top)}e.length>this._limit&&e.shift()}},{key:"getData",value:function(){return this._data}}]);return h}();l("default",m)}}});
System.register("util/facebook.js",["conf.js","ui/alert.js","util/gettext.js"],function(l){function m(c){"undefined"==typeof FB?k(function(){return m(c)}):FB.login(function(a){a="connected"==a.status?{snid:a.authResponse.userID,accessToken:a.authResponse.accessToken}:!1;a&&c?c(a):e(g("social.login_fail"),{ok:g("alert.ok")})},{scope:"public_profile,email"})}function k(c){window.fbAsyncInit=function(){FB.init({appId:h.fb_id,cookie:!0,xfbml:!0,version:"v2.9"});c&&c()};(function(a,b,f){var d=a.getElementsByTagName(b)[0];
if(!a.getElementById(f)){a=a.createElement(b);a.id=f;a.src="//connect.facebook.net/"+("en"==h.lang?"en_US":"cs_CZ")+"/sdk.js";var c=document.querySelector("div.fb-login");a.addEventListener("load",function(a){return c&&c.classList.remove("hidden")});d.parentNode.insertBefore(a,d)}})(document,"script","facebook-jssdk")}var h,e,g;l("checkLoginState",m);l("init",k);return{setters:[function(c){h=c["default"]},function(c){e=c["default"]},function(c){g=c._}],execute:function(){}}});
System.register("util/gettext.js",[],function(l){function m(h){for(var e=arguments.length,g=Array(1<e?e-1:0),c=1;c<e;c++)g[c-1]=arguments[c];e=h.split(".");for(c=window.DICT||{};e.length;){var a=e.shift();if(!(a in c)||e.length&&"string"==typeof c[a])return h;c=c[a]}return"string"!=typeof c?h:c.replace(/%s/g,function(a,f,d){return"%"==d.charAt(f-1)?a:g.shift()})}var k;l("gettext",m);l("hastext",function(h){return m(h)!=h});l("localize",function(h){Array.from(h.querySelectorAll("[data-locale]")).forEach(function(e){e.appendChild(document.createTextNode(k(e.getAttribute("data-locale"))))});
Array.from(h.querySelectorAll("[data-placeholder]")).forEach(function(e){var g=k(e.getAttribute("data-placeholder"));e.setAttribute("placeholder",g);e.setAttribute("aria-label",g)})});return{setters:[],execute:function(){k=m;l("_",k)}}});
System.register("util/html.js",[],function(l){function m(h){return document.createTextNode(h)}function k(h){var e=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],g=2>=arguments.length||void 0===arguments[2]?"":arguments[2],c=document.createElement(h);g&&c.appendChild(m(g));return Object.assign(c,e)}l("clear",function(h){h.innerHTML=""});l("text",m);l("node",k);l("fragment",function(){return document.createDocumentFragment()});l("button",function(h,e){return k("button",h,e)});l("ico",function(h){var e=
icons[h];if(!e)return console.error("Bad icon name '%s'",h),k("span",{},"\u203d");var g=k("div");g.innerHTML=e;e=g.querySelector("svg");e.classList.add("Ico");e.classList.add("Ico--"+h);return e});return{setters:[],execute:function(){}}});
System.register("util/keypair.js",[],function(l){function m(a){a=new Uint8Array(a);a=Array.from(a).map(function(a){return String.fromCharCode(a)}).join("");return btoa(a)}function k(a){a=atob(a).split("").map(function(a){return a.charCodeAt(0)&255});return(new Uint8Array(a)).buffer}var h,e,g,c,a,b=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,f,c){f&&
a(b.prototype,f);c&&a(b,c);return b}}();l("abToString",m);l("stringToAb",k);l("isSupported",function(){return new Promise(function(b,d){if(!e)return b(!1);(function(){try{return b()}catch(p){return d(p)}}).bind(this);var f=function(a){try{return b(!1)}catch(q){return d(q)}}.bind(this);try{return a.generate().then(function(a){try{return b(!0)}catch(q){return f(q)}}.bind(this),f)}catch(p){f(p)}}.bind(this))});l("test",function(){return new Promise(function(b,d){var f=this,c=function(){try{return b()}catch(t){return d(t)}}.bind(this),
e=function(a){try{return console.error(a),c()}catch(v){return d(v)}}.bind(this);try{var g=function(){var b=void 0,d=void 0,g=void 0,n=void 0,r=void 0,h=void 0,q=void 0,k=void 0;return{v:a.generate("test").then(function(f){try{return b=f,console.log("generated kp1",b),d=btoa("a"),console.log("challenge",d),b.sign(d).then(function(f){try{return g=f,console.log("signature",g),b.verify(g,d).then(function(f){try{return n=f,console.log("verification 1",n?"OK":"FAIL"),b.toString().then(function(f){try{return r=
f,console.log("serialized as",r),a.fromString(r).then(function(a){try{return h=a,console.log("parsed as",h),h.verify(g,d).then(function(a){try{return q=a,console.log("verification 2",q?"OK":"FAIL"),b.exportPublic().then(function(a){try{return k=a,console.log("exported pubkey",k),c()}catch(F){return e(F)}}.bind(this),e)}catch(I){return e(I)}}.bind(this),e)}catch(H){return e(H)}}.bind(this),e)}catch(G){return e(G)}}.bind(this),e)}catch(E){return e(E)}}.bind(this),e)}catch(D){return e(D)}}.bind(this),
e)}catch(C){return e(C)}}.bind(f),e)}}();if("object"===typeof g)return g.v}catch(t){e(t)}}.bind(this))});return{setters:[],execute:function(){e=(h=window.crypto||window.msCrypto||window.webkitCrypto)?h.subtle||h.msSubtle||h.webkitSubtle:null;g={name:"ECDSA",namedCurve:"P-256"};c={name:"ECDSA",hash:{name:"SHA-256"}};a=function(){function a(b,f,c){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this._name=b;this._priv=f;this._pub=c}b(a,null,[{key:"generate",value:function(a){var b=
1>=arguments.length||void 0===arguments[1]?{}:arguments[1];return new Promise(function(d,f){var c=void 0,n=void 0;c=Object.assign({},g,b);return e.generateKey(c,!0,["sign","verify"]).then(function(b){try{return n=b,d(new this(a,n.privateKey,n.publicKey))}catch(u){return f(u)}}.bind(this),f)}.bind(this))}},{key:"fromString",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];return new Promise(function(d,f){var c=void 0,n=void 0,h=void 0,q=c=void 0;c=Object.assign({},
g,b);n=JSON.parse(a);h=e.importKey("jwk",n.priv,c,!0,["sign"]);c=e.importKey("jwk",n.pub,c,!0,["verify"]);return Promise.all([h,c]).then(function(a){try{return q=a,d(new this(n.name,q[0],q[1]))}catch(y){return f(y)}}.bind(this),f)}.bind(this))}}]);b(a,[{key:"getName",value:function(){return this._name}},{key:"toString",value:function(){return new Promise(function(a,b){var d=void 0,f=void 0,c=void 0,g=void 0;d=e.exportKey("jwk",this._priv);f=e.exportKey("jwk",this._pub);return Promise.all([d,f]).then(function(d){try{return c=
d,g={name:this._name,priv:c[0],pub:c[1]},a(JSON.stringify(g))}catch(u){return b(u)}}.bind(this),b)}.bind(this))}},{key:"sign",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];return new Promise(function(d,f){var e=void 0,g=void 0;a=k(a);e=Object.assign({},c,b);return h.subtle.sign(e,this._priv,a).then(function(a){try{return g=a,d(m(g))}catch(u){return f(u)}}.bind(this),f)}.bind(this))}},{key:"verify",value:function(a,b,f){return new Promise(function(d,e){a=k(a);b=
k(b);e=Object.assign({},c,f);return d(h.subtle.verify(e,this._pub,a,b))}.bind(this))}},{key:"exportPublic",value:function(){return new Promise(function(a,b){var d=void 0;return e.exportKey("spki",this._pub).then(function(f){try{d=f;f=d;var c=new Uint8Array([6,4,43,129,4,112]),e=new Uint8Array([6,7,42,134,72,206,61,2,1]);if((new Uint8Array(f.slice(4,4+c.length))).toString()==c.toString()){var g=e.length-c.length,n=new Uint8Array(f.byteLength+g),h=new Uint8Array(f.slice(0,4)),q=new Uint8Array(f.slice(4+
c.length));n.set(h,0);n.set(e,4);n.set(q,4+e.length);n[3]+=g;n[1]+=g;d=n.buffer}else d=f;return a(m(d))}catch(w){return b(w)}}.bind(this),b)}.bind(this))}}]);return a}();l("default",a)}}});
System.register("util/log.js",[],function(l){l("logRemote",function(m){var k={s:"consent-dialog",u:location.href,abtest:"abtest",a:m,d:1>=arguments.length||void 0===arguments[1]?{}:arguments[1]},h=[],e;for(e in k){var g=k[e];"d"==e&&(g=JSON.stringify(g));h.push(encodeURIComponent(e)+"="+encodeURIComponent(g))}(new Image).src="//jslog.post.cz/hit/?"+h.join("&")});return{setters:[],execute:function(){}}});
System.register("util/md5.js",[],function(l){function m(c,a,b,f,d,e){c=g(g(a,c),g(f,e));return g(c<<d|c>>>32-d,b)}function k(c,a,b,f,d,e,g){return m(a&b|~a&f,c,a,d,e,g)}function h(c,a,b,f,d,e,g){return m(a&f|b&~f,c,a,d,e,g)}function e(c,a,b,f,d,e,g){return m(b^(a|~f),c,a,d,e,g)}function g(c,a){var b=(c&65535)+(a&65535);return(c>>16)+(a>>16)+(b>>16)<<16|b&65535}return{setters:[],execute:function(){l("default",function(c){var a="";for(var b=0;b<c.length;b++){var f=c.charCodeAt(b);128>f?a+=String.fromCharCode(f):
(127<f&&2048>f?a+=String.fromCharCode(f>>6|192):(a+=String.fromCharCode(f>>12|224),a+=String.fromCharCode(f>>6&63|128)),a+=String.fromCharCode(f&63|128))}c=[];for(b=0;b<8*a.length;b+=8)c[b>>5]|=(a.charCodeAt(b/8)&255)<<b%32;a=8*a.length;c[a>>5]|=128<<a%32;c[(a+64>>>9<<4)+14]=a;a=1732584193;b=-271733879;f=-1732584194;for(var d=271733878,n=0;n<c.length;n+=16){var p=a,q=b,r=f,t=d;a=k(a,b,f,d,c[n+0],7,-680876936);d=k(d,a,b,f,c[n+1],12,-389564586);f=k(f,d,a,b,c[n+2],17,606105819);b=k(b,f,d,a,c[n+3],22,
-1044525330);a=k(a,b,f,d,c[n+4],7,-176418897);d=k(d,a,b,f,c[n+5],12,1200080426);f=k(f,d,a,b,c[n+6],17,-1473231341);b=k(b,f,d,a,c[n+7],22,-45705983);a=k(a,b,f,d,c[n+8],7,1770035416);d=k(d,a,b,f,c[n+9],12,-1958414417);f=k(f,d,a,b,c[n+10],17,-42063);b=k(b,f,d,a,c[n+11],22,-1990404162);a=k(a,b,f,d,c[n+12],7,1804603682);d=k(d,a,b,f,c[n+13],12,-40341101);f=k(f,d,a,b,c[n+14],17,-1502002290);b=k(b,f,d,a,c[n+15],22,1236535329);a=h(a,b,f,d,c[n+1],5,-165796510);d=h(d,a,b,f,c[n+6],9,-1069501632);f=h(f,d,a,b,
c[n+11],14,643717713);b=h(b,f,d,a,c[n+0],20,-373897302);a=h(a,b,f,d,c[n+5],5,-701558691);d=h(d,a,b,f,c[n+10],9,38016083);f=h(f,d,a,b,c[n+15],14,-660478335);b=h(b,f,d,a,c[n+4],20,-405537848);a=h(a,b,f,d,c[n+9],5,568446438);d=h(d,a,b,f,c[n+14],9,-1019803690);f=h(f,d,a,b,c[n+3],14,-187363961);b=h(b,f,d,a,c[n+8],20,1163531501);a=h(a,b,f,d,c[n+13],5,-1444681467);d=h(d,a,b,f,c[n+2],9,-51403784);f=h(f,d,a,b,c[n+7],14,1735328473);b=h(b,f,d,a,c[n+12],20,-1926607734);a=m(b^f^d,a,b,c[n+5],4,-378558);d=m(a^b^
f,d,a,c[n+8],11,-2022574463);f=m(d^a^b,f,d,c[n+11],16,1839030562);b=m(f^d^a,b,f,c[n+14],23,-35309556);a=m(b^f^d,a,b,c[n+1],4,-1530992060);d=m(a^b^f,d,a,c[n+4],11,1272893353);f=m(d^a^b,f,d,c[n+7],16,-155497632);b=m(f^d^a,b,f,c[n+10],23,-1094730640);a=m(b^f^d,a,b,c[n+13],4,681279174);d=m(a^b^f,d,a,c[n+0],11,-358537222);f=m(d^a^b,f,d,c[n+3],16,-722521979);b=m(f^d^a,b,f,c[n+6],23,76029189);a=m(b^f^d,a,b,c[n+9],4,-640364487);d=m(a^b^f,d,a,c[n+12],11,-421815835);f=m(d^a^b,f,d,c[n+15],16,530742520);b=m(f^
d^a,b,f,c[n+2],23,-995338651);a=e(a,b,f,d,c[n+0],6,-198630844);d=e(d,a,b,f,c[n+7],10,1126891415);f=e(f,d,a,b,c[n+14],15,-1416354905);b=e(b,f,d,a,c[n+5],21,-57434055);a=e(a,b,f,d,c[n+12],6,1700485571);d=e(d,a,b,f,c[n+3],10,-1894986606);f=e(f,d,a,b,c[n+10],15,-1051523);b=e(b,f,d,a,c[n+1],21,-2054922799);a=e(a,b,f,d,c[n+8],6,1873313359);d=e(d,a,b,f,c[n+15],10,-30611744);f=e(f,d,a,b,c[n+6],15,-1560198380);b=e(b,f,d,a,c[n+13],21,1309151649);a=e(a,b,f,d,c[n+4],6,-145523070);d=e(d,a,b,f,c[n+11],10,-1120210379);
f=e(f,d,a,b,c[n+2],15,718787259);b=e(b,f,d,a,c[n+9],21,-343485551);a=g(a,p);b=g(b,q);f=g(f,r);d=g(d,t)}c=[a,b,f,d];a="";for(b=0;b<4*c.length;b++)a+="0123456789abcdef".charAt(c[b>>2]>>b%4*8+4&15)+"0123456789abcdef".charAt(c[b>>2]>>b%4*8&15);return a})}}});
System.register("util/net.js",["ui/loader.js","conf.js"],function(l){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function k(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a,b,d){return(new n(a,
b,d)).getPromise()}var e,g,c,a,b,f,d,n,p=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),q=function(a,b,d){var f=!0;for(;f;)if(null===a&&(a=Function.prototype),f=Object.getOwnPropertyDescriptor(a,b),void 0===f){a=Object.getPrototypeOf(a);if(null===a)break;f=!0}else{if("value"in f)return f.value;b=f.get;return void 0===
b?void 0:b.call(d)}};l("request",h);l("help",function(a){return h(a,null,{method:"HELP",prefix:""})});return{setters:[function(a){e=a},function(a){g=a["default"]}],execute:function(){c={timeout:0,prefix:"/api/v1",method:"post"};a=function(a){function b(a,f,d){m(this,b);q(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,f);this.message=f;this.status=a;this.response=d;403==a&&location.reload()}k(b,a);return b}(Error);l("HTTPError",a);b=function(a){function b(){m(this,b);q(Object.getPrototypeOf(b.prototype),
"constructor",this).call(this,"Request timed out");this.message="Request timed out"}k(b,a);return b}(Error);l("TimeoutError",b);f=function(a){function b(){m(this,b);q(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,"Network error");this.message="Network error"}k(b,a);return b}(Error);l("NetworkError",f);d=function(a){function b(){m(this,b);q(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,"Request aborted");this.message="Request aborted"}k(b,a);return b}(Error);l("AbortError",
d);n=function(){function n(){var a=0>=arguments.length||void 0===arguments[0]?"/":arguments[0],b=this,f=1>=arguments.length||void 0===arguments[1]?null:arguments[1],d=2>=arguments.length||void 0===arguments[2]?{}:arguments[2];m(this,n);this._reject=this._resolve=null;this._options=Object.assign({},c,d);this._promise=new Promise(function(a,d){b._resolve=a;b._reject=d});d=new XMLHttpRequest;d.addEventListener("abort",this);d.addEventListener("error",this);d.addEventListener("timeout",this);d.addEventListener("load",
this);if(g.uid){var h=-1<a.indexOf("?")?"&":"?";a=""+a+h+"uid="+g.uid}d.open(this._options.method,""+this._options.prefix+a,!0);"timeout"in d&&"function"!=typeof d.timeout&&(d.timeout=this._options.timeout);d.setRequestHeader("Accept","application/json;q=0.9,*/*;q=0.8");f&&(f=JSON.stringify(f),d.setRequestHeader("Content-type","application/json"));d.send(f);this._xhr=d;e.start()}p(n,[{key:"getPromise",value:function(){return this._promise}},{key:"abort",value:function(){this._xhr&&(this._xhr.abort(),
this._reject(new d))}},{key:"handleEvent",value:function(a){e.stop();switch(a.type){case "abort":this._reject(new d);break;case "error":this._reject(new f);break;case "timeout":this._reject(new b);break;case "load":this._response(a.target)}}},{key:"_response",value:function(b){var d=b.responseText;if(-1<b.getResponseHeader("content-type").indexOf("application/json"))try{d=JSON.parse(d)}catch(z){this._reject(z);return}var f=b.status;200>f||300<=f?this._reject(new a(f,b.statusText,d)):this._resolve(d)}}]);
return n}();l("Request",n)}}});
System.register("util/neznam.js",["conf.js"],function(l){var m;l("handlesDomain",function(k){return-1<m.neznam_domains.indexOf(k)});l("redirect",function(){var k=m.neznam.client_id,h=location.href,e=-1<h.indexOf("?")?"&":"?";k={client_id:k,response_type:"code",redirect_uri:""+h+e+"neznam=result"};h=[];for(g in k)h.push([g,k[g]].map(encodeURIComponent).join("="));var g="https://auth2.szn.cz/oauth2/authorize/?"+h.join("&");location.href=g});return{setters:[function(k){m=k["default"]}],execute:function(){}}});
System.register("util/pubsub.js",[],function(l){var m;l("publish",function(k,h,e){(m[k]||[]).forEach(function(g){"function"==typeof g?g(k,h,e):g.handleMessage(k,h,e)})});l("subscribe",function(k,h){k in m||(m[k]=[]);m[k].push(h)});l("unsubscribe",function(k,h){h=(m[k]||[]).indexOf(h);-1<h&&m[k].splice(h,1)});return{setters:[],execute:function(){m=Object.create(null)}}});
System.register("util/sf.js",[],function(l){var m;return{setters:[],execute:function(){m=function(k){var h=!0;navigator&&navigator.userAgent&&-1<navigator.userAgent.toLowerCase().indexOf("hbbtv")&&(h=!1);this._options={ua:!1,text:!0,canvas:h,log:null};for(var e in k)this._options[e]=k[e];this._options.canvas&&!document.createElement("canvas").getContext&&(this._options.canvas=!1)};m.prototype.get=function(k){for(var h in k)this._options[h]=k[h];this._log("-> get fingerprint with options",this._options);
k="";this._options.text&&(k+=this._getText());this._options.canvas&&(k+=this._getCanvas());return k};m.prototype._getText=function(){var k="";this._log("getting navigator props");var h=["buildID","battery","appVersion","mimeTypes"];this._options.ua||h.push("userAgent");var e=[],g=0;(function d(a){if(!(-1<e.indexOf(a)||3<g)){g++;e.push(a);for(var f in a)if(!(-1<h.indexOf(f))){var c=a[f];switch(typeof c){case "object":try{d(c)}catch(q){}break;case "number":case "string":k+=c}}g--}})(navigator);if(this._options.canvas){var c=
document.createElement("canvas"),a=null;try{a=c.getContext("experimental-webgl")||c.getContext("webgl")}catch(f){}a&&(this._log("adding webgl props"),k+=a.getParameter(a.VENDOR),k+=a.getParameter(a.RENDERER),k+=a.getParameter(a.VERSION))}this._log("text data:",k);return this._hash(k)};m.prototype._getCanvas=function(){var k=this._drawCanvas().toDataURL("image/jpeg");this._log("image data:",k);return this._hash(k)};m.prototype._drawCanvas=function(){var k=document.createElement("canvas"),h=k.getContext("2d");
h.fillStyle="#fff";h.fillRect(0,0,k.width,k.height);var e=[];[32,64,96,256].forEach(function(g,c){c="";for(var a=0;25>a;a++)c+=String.fromCharCode(g+a);e.push(c)});[{font:"14px droid sand mono,ubuntu,serif",fill:"rgba(255, 30, 30, 0.3)",stroke:"rgba(30, 30, 255, 0.3)"},{font:"12pt helvetica,arial,sans-serif",fill:"rgba(30, 255, 30, 0.3)",stroke:"rgba(255, 255, 30, 0.3)"}].forEach(function(g,c){h.font=g.font;h.fillStyle=g.fill;h.strokeStyle=g.stroke;e.forEach(function(a,b){b=20*(1+b+c/3);h.strokeText(a,
0,b);h.fillText(a,0,b)})});this._log(k);return k};m.prototype._hash=function(k){var h=this._fnv1aHashString(k);this._log("num",h);k="";for(var e=0;8>e;e++)k=(h>>4*e&15).toString(16)+k;h=parseInt(k,16)%17;this._log("control",h);return k+=(h%16).toString(16)};m.prototype._fnv1aHashString=function(k){for(var h=2166136261,e=0,g=k.length;e<g;e++){var c=k.charCodeAt(e)&255;h^=c;h=16777619*h|0}return h};m.prototype._log=function(){var k=this._options.log;if(k){for(var h=[],e=0;e<arguments.length;e++){var g=
arguments[e];g.nodeType?k.appendChild(g):h.push("object"==typeof g?JSON.stringify(g):g)}h=document.createTextNode(h.join(" ")+"\n");k.appendChild(h)}};l("default",m)}}});
System.register("util/tfa-loop.js",["util/net.js","conf.js"],function(l){var m,k,h,e=function(){function e(c,a){for(var b=0;b<a.length;b++){var f=a[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(c,f.key,f)}}return function(c,a,b){a&&e(c.prototype,a);b&&e(c,b);return c}}();return{setters:[function(e){m=e},function(e){k=e["default"]}],execute:function(){h=function(){function g(){if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");
this._check()}e(g,[{key:"onAllow",value:function(c){}},{key:"onDeny",value:function(){}},{key:"onError",value:function(c){}},{key:"push",value:function(){return m.request("/2fa/request/push",{})}},{key:"sms",value:function(){return m.request("/2fa/request/sms",{})}},{key:"pin",value:function(c){return m.request("/2fa/resolution-pin",{pin:c})}},{key:"_check",value:function(){var c=this;m.request("/2fa/progress?r="+Math.random(),null,{method:"GET"}).then(function(a){if("verified"in a&&!a.verified)setTimeout(function(){return c._check()},
k.tfaRetry);else c.onAllow(a)},function(a){return c._handleError(a)})}},{key:"_handleError",value:function(c){if(c instanceof m.HTTPError&&400==c.status&&401==c.response.status)this.onDeny();else this.onError(c)}}]);return g}();l("default",h)}}});
System.register("util/various.js",["conf.js","app.js"],function(l){var m,k;l("fullAvatarUrl",function(h){return h?h+"/"+Math.round((1>=arguments.length||void 0===arguments[1]?64:arguments[1])*(window.devicePixelRatio||1))+"?"+Math.random():h});l("goContinue",function(){if(m.oauth)k.setView("oauth");else{var h=encodeURIComponent(m.return_url),e=encodeURIComponent(m.service);location.href=m.registerContinue||"/continue?return_url="+h+"&service="+e}});l("parseSearch",function(h){var e={};"?"==h.charAt(0)&&
(h=h.substring(1));0<h.length&&h.split("&").forEach(function(g){g=g.split("=").map(decodeURIComponent);e[g[0]]=g[1]});return e});return{setters:[function(h){m=h["default"]},function(h){k=h}],execute:function(){}}});
System.register("util/warning.js",[],function(l){var m,k=function(){function h(e,g){for(var c=0;c<g.length;c++){var a=g[c];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(e,g,c){g&&h(e.prototype,g);c&&h(e,c);return e}}();return{setters:[],execute:function(){m=function(){function h(e){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");this._targetNode=e}k(h,[{key:"show",value:function(e){this._node?
this._setText(e):this._build(e)}},{key:"hide",value:function(){this._node&&(this._node.style.height=0)}},{key:"_build",value:function(e){this._node=document.createElement("p");this._node.appendChild(document.createElement("i"));this._node.className="error";for(var g=this._targetNode.nextSibling;g&&!g.classList;)g=g.nextSibling;this._targetNode.parentNode.insertBefore(this._node,g);this._setText(e)}},{key:"_setText",value:function(e){this._node.querySelector("i").innerHTML=e;this._animate()}},{key:"_animate",
value:function(){var e=this._node.scrollHeight;this._node.style.height=0;this._node.offsetWidth;this._node.style.height=e+"px"}}]);return h}();l("default",m)}}});
System.register("validators/agree.js",["validators/base.js","util/gettext.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g=function(){function a(a,f){for(var b=0;b<f.length;b++){var c=f[b];c.enumerable=c.enumerable||
!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,f,d){f&&a(b.prototype,f);d&&a(b,d);return b}}(),c=function(a,b,f){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(f)}};return{setters:[function(a){k=a["default"]},function(a){h=a._}],execute:function(){e=function(a){function b(a,
d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");c(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a);this._checkbox=d;this._checkbox.addEventListener("click",this)}m(b,a);g(b,[{key:"show",value:function(){c(Object.getPrototypeOf(b.prototype),"show",this).call(this,h("register.validation.agree"))}},{key:"validate",value:function(a){a=this._checkbox.checked;this[a?"hide":"show"]();return Promise.resolve(a)}},{key:"handleEvent",value:function(a){this.validate(!1)}}]);
return b}(k);l("default",e)}}});
System.register("validators/base.js",["util/warning.js"],function(l){var m,k,h=function(){function e(e,c){for(var a=0;a<c.length;a++){var b=c[a];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(e,b.key,b)}}return function(g,c,a){c&&e(g.prototype,c);a&&e(g,a);return g}}();return{setters:[function(e){m=e["default"]}],execute:function(){k=function(){function e(g,c){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._targetNode=
g;this._inputNode=c;this._timeout=null;this._warning=new m(g);this._touchClasslist=!1}h(e,[{key:"validate",value:function(e){return Promise.resolve(!0)}},{key:"show",value:function(e){this._warning.show(e);this._inputNode&&!this._inputNode.classList.contains("error")&&(this._inputNode.classList.add("error"),this._touchClasslist=!0)}},{key:"hide",value:function(){this._warning.hide();this._inputNode&&this._touchClasslist&&(this._inputNode.classList.remove("error"),this._touchClasslist=!1)}},{key:"_delayInput",
value:function(){this._timeout&&clearTimeout(this._timeout);this._timeout=setTimeout(function(){this.handleEvent({type:"input-delayed"})}.bind(this),500)}}]);return e}();l("default",k)}}});
System.register("validators/birthyear.js",["validators/base.js","util/gettext.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g=function(){function a(a,f){for(var b=0;b<f.length;b++){var c=f[b];c.enumerable=
c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,f,d){f&&a(b.prototype,f);d&&a(b,d);return b}}(),c=function(a,b,f){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(f)}};return{setters:[function(a){k=a["default"]},function(a){h=a._}],execute:function(){e=
function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");c(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,a);this._targetNode.addEventListener("blur",this)}m(b,a);g(b,[{key:"show",value:function(){c(Object.getPrototypeOf(b.prototype),"show",this).call(this,h("recover.validation.birth_year"))}},{key:"validate",value:function(a){a=this._targetNode.value.trim();var b=!0;a&&(a=parseInt(a),b=!isNaN(a)&&1900<=a&&a<=(new Date).getFullYear(),
this._targetNode.disabled&&(b=!0));this[b?"hide":"show"]();return Promise.resolve(b)}},{key:"handleEvent",value:function(a){switch(a.type){case "blur":this.validate(!1)}}}]);return b}(k);l("default",e)}}});
System.register("validators/email.js",["validators/base.js","util/gettext.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g=function(){function a(a,f){for(var b=0;b<f.length;b++){var c=f[b];c.enumerable=c.enumerable||
!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,f,d){f&&a(b.prototype,f);d&&a(b,d);return b}}(),c=function(a,b,f){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(f)}};return{setters:[function(a){k=a["default"]},function(a){h=a._}],execute:function(){e=function(a){function b(a,
d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");c(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,a);this.allowEmpty=d;this._targetNode.addEventListener("blur",this)}m(b,a);g(b,[{key:"show",value:function(a){a||(a=h("recover.validation.email"));c(Object.getPrototypeOf(b.prototype),"show",this).call(this,a)}},{key:"validate",value:function(a){a=this._targetNode.value.trim();if(!a)return this.show(h("recover.validation.empty")),Promise.resolve(!1);
a=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(a)||this.allowEmpty&&""===a;this[a?"hide":"show"]();return Promise.resolve(a)}},{key:"handleEvent",value:function(a){switch(a.type){case "blur":this.validate(!1)}}}]);return b}(k);l("default",e)}}});
System.register("validators/emailserver.js",["validators/base.js","validators/email.js","util/gettext.js","util/net.js","util/error.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g,c,a=function(){function a(a,
b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,f,c){f&&a(b.prototype,f);c&&a(b,c);return b}}(),b=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){},
function(a){k=a["default"]},function(a){h=a._},function(a){e=a},function(a){g=a["default"]}],execute:function(){c=function(f){function d(a,f){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");b(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,a,!1);this.parent=f}m(d,f);a(d,[{key:"validate",value:function(){var a=this,b=this._targetNode.value.trim();return e.request("/username-deliverable/"+encodeURIComponent(b),null,{method:"get"}).then(function(b){return a._responseOk(b)},
function(b){return a._responseKo(b)})}},{key:"_responseOk",value:function(a){b(Object.getPrototypeOf(d.prototype),"hide",this).call(this);return!0}},{key:"_responseKo",value:function(a){switch(a.status){case 404:case 422:this.show(h("recover.validation.email"));break;default:g(a)}return!1}}]);return d}(k);l("default",c)}}});
System.register("validators/nonempty.js",["validators/base.js","util/gettext.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g=function(){function a(a,f){for(var b=0;b<f.length;b++){var c=f[b];c.enumerable=
c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,f,d){f&&a(b.prototype,f);d&&a(b,d);return b}}(),c=function(a,b,f){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(f)}};return{setters:[function(a){k=a["default"]},function(a){h=a._}],execute:function(){e=
function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");c(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,a);this._targetNode.addEventListener("blur",this)}m(b,a);g(b,[{key:"show",value:function(a){a||(a=h("recover.validation.empty"));c(Object.getPrototypeOf(b.prototype),"show",this).call(this,a)}},{key:"validate",value:function(a){a=""!=this._targetNode.value.trim();this[a?"hide":"show"]();return Promise.resolve(a)}},{key:"handleEvent",
value:function(a){switch(a.type){case "blur":this.validate(!1)}}}]);return b}(k);l("default",e)}}});
System.register("validators/password.js",["validators/base.js","util/gettext.js","util/net.js","util/error.js","conf.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g,c,a,b=function(){function a(a,b){for(var d=
0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}();return{setters:[function(a){k=a["default"]},function(a){h=a._},function(a){e=a},function(a){g=a["default"]},function(a){c=a["default"]}],execute:function(){a=function(a){function d(a,b,c){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");a:{var f=Object.getPrototypeOf(d.prototype),
e="constructor";var g=this;var h=!0;for(;h;)if(null===f&&(f=Function.prototype),h=Object.getOwnPropertyDescriptor(f,e),void 0===h){f=Object.getPrototypeOf(f);if(null===f)break;h=!0}else{if("value"in h){g=h.value;break a}e=h.get;g=void 0===e?void 0:e.call(g);break a}g=void 0}g.call(this,a,a);this._username=b;this._domain=c;a=document.createElement("div");a.style.display="none";a.classList.add("widget-strength");this._strength=document.createElement("div");a.appendChild(this._strength);this._targetNode.parentNode.insertBefore(a,
this._targetNode.nextSibling);this._targetNode.addEventListener("input",this)}m(d,a);b(d,[{key:"validate",value:function(a){var b=this,d=this._targetNode.value;if(!d){this._setWidth(0,100);if(a)return this.show(h("register.validation.password.empty")),Promise.resolve(!1);this.hide();return Promise.resolve(!0)}a={password:d,service:c.service};this._username&&(a.username=this._domain?""+this._username.value+this._domain.value:this._username);return e.request("/password-strength",a).then(function(a){return b._passwordDone(a)},
function(a){return b._passwordError(a)})}},{key:"handleEvent",value:function(a){switch(a.type){case "input":this._delayInput();break;case "input-delayed":this.validate(!1)}}},{key:"setUsername",value:function(a){this._username=a}},{key:"_setWidth",value:function(a,b){var d=this;this._strength.parentNode.style.display=a?"":"none";this._strength.style.width=a+"%";a>=b?function(){var c=(a-b)/(100-b),f=[76,218,76],e=[255,165,0].map(function(a,b){return Math.round(a+c*(f[b]-a))});d._strength.style.backgroundColor=
"rgb("+e.join(",")+")"}():this._strength.style.backgroundColor="red"}},{key:"_passwordDone",value:function(a){this._setWidth(a.strength,a.limit);if(a.strength>=a.limit)return this.hide(),!0;this.show(h("register.validation.password.weak"));return!1}},{key:"_passwordError",value:function(a){if(a instanceof e.HTTPError&&400==a.status)switch(a.response.status){case 476:this.show(h("register.validation.password.short"));break;case 477:this.show(h("register.validation.password.long"));break;case 491:this.show(h("register.validation.password.malformed"));
break;case 492:this.show(h("register.validation.password.historic"));break;case 493:this.show(h("register.validation.password.similar"));break;default:g(a)}else g(a);return!1}}]);return d}(k);l("default",a)}}});
System.register("validators/passwordmatch.js",["validators/base.js","util/gettext.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g=function(){function a(a,c){for(var b=0;b<c.length;b++){var f=c[b];f.enumerable=
f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a._}],execute:function(){e=
function(a){function b(a,d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");c(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,d[1]);this._inputs=d;this._inputs[0].addEventListener("input",this);this._inputs[1].addEventListener("blur",this)}m(b,a);g(b,[{key:"show",value:function(){c(Object.getPrototypeOf(b.prototype),"show",this).call(this,h("register.validation.password.match"))}},{key:"validate",value:function(a){a=this._inputs[0].value==this._inputs[1].value;
this[a?"hide":"show"]();return Promise.resolve(a)}},{key:"handleEvent",value:function(a){switch(a.type){case "input":this._inputs[1].value&&this.validate(!1);break;case "blur":this.validate(!1)}}}]);return b}(k);l("default",e)}}});
System.register("validators/phone.js",["validators/base.js","util/gettext.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g=function(){function a(a,c){for(var b=0;b<c.length;b++){var f=c[b];f.enumerable=f.enumerable||
!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a._}],execute:function(){e=function(a){function b(a,
d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");c(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,d);d.addEventListener("blur",this)}m(b,a);g(b,[{key:"show",value:function(a){c(Object.getPrototypeOf(b.prototype),"show",this).call(this,a||h("secure.validation.phone.bad_number"))}},{key:"extractNumber",value:function(){return this._inputNode.value.replace(/\D/g,"")}},{key:"validate",value:function(a){if(!this._inputNode.value.length&&!a)return this.hide(),
Promise.resolve(!0);a=this.extractNumber();if(0==a.length)return this.show(),Promise.resolve(!1);var b=["420","421"];a=9==a.length?!0:12!=a.length?!1:-1===b.indexOf(a.substr(0,3))?!1:!0;this[a?"hide":"show"]();return Promise.resolve(a)}},{key:"handleEvent",value:function(a){switch(a.type){case "blur":this.validate(!1)}}}]);return b}(k);l("default",e)}}});
System.register("validators/username.js",["validators/base.js","util/gettext.js","util/net.js","util/error.js"],function(l){function m(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}var k,h,e,g,c,a=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=
b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();return{setters:[function(a){k=a["default"]},function(a){h=a._},function(a){e=a},function(a){g=a["default"]}],execute:function(){c=function(b){function c(a,b){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");a:{var d=Object.getPrototypeOf(c.prototype),e="constructor";var f=this;var g=!0;
for(;g;)if(null===d&&(d=Function.prototype),g=Object.getOwnPropertyDescriptor(d,e),void 0===g){d=Object.getPrototypeOf(d);if(null===d)break;g=!0}else{if("value"in g){f=g.value;break a}e=g.get;f=void 0===e?void 0:e.call(f);break a}f=void 0}f.call(this,b,a);a.form.querySelector("[for="+a.id+"]");this._username=a;this._domain=b;this._username.addEventListener("input",this);this._username.addEventListener("blur",this);this._domain.addEventListener("change",this);this._lastEvent=""}m(c,b);a(c,[{key:"validate",
value:function(a){var b=this,c=this._domain.value;if(a||!(!c&&"blur"!=this._lastEvent||c&&"blur"==this._lastEvent)){var d=this._username.value;if(!d){if(a)return this.show(h("register.validation.username.empty")),Promise.resolve(!1);this.hide();return Promise.resolve(!0)}return e.request("/username-check/"+encodeURIComponent(""+d+c),null,{method:"get"}).then(function(a){return b._responseOk(a)},function(a){return b._usernameError(a)})}}},{key:"handleEvent",value:function(a){switch(a.type){case "input":this._delayInput();
break;case "blur":this._lastEvent="blur";this.validate(!1);break;case "change":case "input-delayed":this._lastEvent="change",this.validate(!1)}}},{key:"_responseOk",value:function(a){a.available?this.hide():a.alternatives.length?this.show(h("register.validation.username.alternative",a.alternatives[0])):this.show(h("register.validation.username.exists"));return a.available}},{key:"_usernameError",value:function(a){if(a instanceof e.HTTPError&&400==a.status)switch(a.response.status){case 484:this.show(h("register.validation.username.mxdomain"));
break;case 486:this.show(h("register.validation.username.malformed"));break;case 487:this.show(h("register.validation.username.long"));break;case 488:this.show(h("register.validation.username.short"));break;default:g(a)}else g(a);return!1}}]);return c}(k);l("default",c)}}});
System.register("view/avatar.js","./base.js util/net.js util/html.js util/gettext.js util/various.js conf.js util/error.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g,c,a,b,f,d,n=function(){function a(a,
b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),p=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=
a["default"]},function(a){h=a},function(a){e=a},function(a){g=a._},function(b){c=b.fullAvatarUrl;a=b.goContinue},function(a){b=a["default"]},function(a){f=a["default"]}],execute:function(){d=function(d){function k(){var a=this;if(!(this instanceof k))throw new TypeError("Cannot call a class as a function");p(Object.getPrototypeOf(k.prototype),"constructor",this).call(this,"avatar");this._node.querySelector(".placeholder").innerHTML=g("avatar.html");Array.from(this._node.querySelectorAll("button, button + a")).forEach(function(b){return b.addEventListener("click",
a)})}m(k,d);n(k,[{key:"activate",value:function(){p(Object.getPrototypeOf(k.prototype),"activate",this).call(this);document.title=g("avatar.title");var a=this._node.querySelector(".email");e.clear(a);a.appendChild(e.text(b.email));this._node.querySelector("img").src=c(b.avatar_url,32)}},{key:"handleEvent",value:function(b){b.preventDefault();b="accept"==b.target.getAttribute("data-purpose");h.request("/user/properties/avatar-consent",{consent:b},{method:"PUT"}).then(function(b){return a()},f)}}]);
return k}(k);l("default",new d)}}});
System.register("view/base.js",[],function(l){var m,k=function(){function h(e,g){for(var c=0;c<g.length;c++){var a=g[c];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(e,g,c){g&&h(e.prototype,g);c&&h(e,c);return e}}();return{setters:[],execute:function(){m=function(){function h(e){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");this._node=document.querySelector("#"+e);this._h1=this._node.querySelector("h1");
this._h2=this._node.querySelector("h2")}k(h,[{key:"getId",value:function(){return this._node.id}},{key:"activate",value:function(){this._h1.classList.add("hidden");this._h2.classList.add("hidden");var e=document.querySelector("header");e.querySelector("h1").textContent=this._h1.textContent;e.querySelector("h2").textContent=this._h2.textContent;e.querySelector("h1").innerText=this._h1.innerText;e.querySelector("h2").innerText=this._h2.innerText;this._node.classList.remove("hidden");document.body.classList.add(this.getId())}},
{key:"deactivate",value:function(){document.body.classList.remove(this.getId());this._node.classList.add("hidden")}}]);return h}();l("default",m)}}});
System.register("view/gdpr-unblock.js","./base.js util/net.js util/gettext.js util/various.js ui/vcard.js ui/alert.js validators/agree.js validators/nonempty.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}
var k,h,e,g,c,a,b,f,d,n,p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();return{setters:[function(a){k=a["default"]},function(a){h=a},function(a){e=a._},function(a){g=a.goContinue;c=a.fullAvatarUrl},function(b){a=b["default"]},function(a){b=a["default"]},function(a){f=a["default"]},function(a){d=a["default"]}],
execute:function(){n=function(k){function n(a,b,c){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");a:{var d=Object.getPrototypeOf(n.prototype),e="constructor";var f=this;var g=!0;for(;g;)if(null===d&&(d=Function.prototype),g=Object.getOwnPropertyDescriptor(d,e),void 0===g){d=Object.getPrototypeOf(d);if(null===d)break;g=!0}else{if("value"in g){f=g.value;break a}e=g.get;f=void 0===e?void 0:e.call(f);break a}f=void 0}f.call(this,"blocked-gdpr");this._name=a;this._email=
b;this._avatar=c;this._validators={};this._build()}m(n,k);p(n,[{key:"handleEvent",value:function(a){var b=this;this._node.querySelector("button");a=Object.keys(this._validators).map(function(a){return b._validators[a].validate(!0)});Promise.all(a).then(function(a){a.every(function(a){return a})&&b._runUnblock()})}},{key:"getNode",value:function(){return this._node}},{key:"_build",value:function(){var b=this._node.querySelector(".vCard-placeholder");new a(this._name,this._email,c(this._avatar),b);
b=this._node.querySelector("button");var e=this._node.querySelector("input[type='checkbox']"),g=this._node.querySelector("input[type='password']");this._validators.agree=new f(e.parentNode.lastChild,e);this._validators.password=new d(g);b.addEventListener("click",this,!1)}},{key:"_runUnblock",value:function(){var a=this,b={username:this._email,password:this._node.querySelector("input[type='password']").value};h.request("/cancel-delete",b,{method:"POST"}).then(function(b){a._unblockResponseOK(b)},
function(b){a._unblockResponseKO(b)})["catch"](function(b){a._unblockResponseKO(b)})}},{key:"_unblockResponseOK",value:function(a){200!=a.status&&this._unblockResponseKO(a);b(e("blockedGdpr.cancelSuccess"),{ok:e("blockedGdpr.continue")}).then(function(a){g()})}},{key:"_unblockResponseKO",value:function(a){if(a instanceof h.HTTPError)if(a.response)switch(a.response.status){case 401:this._wrongPassword();break;case 439:window.location="/";break;default:b(e("blockedGdpr.errors.commonError"),{ok:e("blockedGdpr.close")})}else b(e("blockedGdpr.errors.commonError"),
{ok:e("blockedGdpr.close")});else b(e("blockedGdpr.errors.commonError"),{ok:e("blockedGdpr.close")})}},{key:"_wrongPassword",value:function(){e("blockedGdpr.errors.badPassword");var a=this._validators.password;a&&a.show(e("blockedGdpr.errors.badPassword"))}}]);return n}(k);l("default",n)}}});
System.register("view/help.js",["./base.js","util/net.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g=function(){function a(a,c){for(var b=0;b<c.length;b++){var e=c[b];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a}],execute:function(){e=function(a){function b(){if(!(this instanceof
b))throw new TypeError("Cannot call a class as a function");c(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,"help");this._node.querySelector("form").addEventListener("submit",this);this._select=this._node.querySelector("select");this._select.addEventListener("change",this);this._result=this._node.querySelector("pre");this._inputs={}}m(b,a);g(b,[{key:"activate",value:function(){var a=this;c(Object.getPrototypeOf(b.prototype),"activate",this).call(this);h.request("/help.list",null,
{prefix:"",method:"get"}).then(function(b){return a._build(b)})}},{key:"handleEvent",value:function(a){var b=this;switch(a.type){case "submit":a.preventDefault();this._doSubmit();break;case "change":var c=this._node.querySelector("p.inputs");c.innerHTML="";this._inputs={};this._result.innerHTML="";var e=!1;a.target.value.replace(/<(.*?)>/g,function(a,d){a=document.createElement("label");c.appendChild(a);a.appendChild(document.createTextNode(d+": "));var f=document.createElement("input");a.appendChild(f);
f.type="text";"version"==d?f.value=1:e=!0;b._inputs[d]=f});e||this._doSubmit()}}},{key:"_doSubmit",value:function(){var a=this,b=this._select.value;b=b.replace(/<(.*?)>/g,function(b,c){return a._inputs[c].value});var c=this._result;h.help(b).then(function(a){c.innerHTML=a},function(a){c.innerHTML=a.message})}},{key:"_build",value:function(a){var b=this,c={};a.split(/\n+/).filter(function(a,b){return 0==b%2}).forEach(function(a){if(a=a.match(/\/.*/))if(a=a[0],!(a in c)){c[a]=1;var d=document.createElement("option");
d.value=a;d.appendChild(document.createTextNode(a));b._select.appendChild(d)}})}}]);return b}(k);l("default",new e)}}});
System.register("view/licence.js","./base.js util/net.js util/gettext.js util/various.js conf.js util/error.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g,c,a,b=function(){function a(a,b){for(var c=
0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},
function(a){h=a},function(a){e=a._},function(a){g=a.goContinue},function(a){},function(a){c=a["default"]}],execute:function(){a=function(a){function d(){var a=this;if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");f(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,"licence");this._node.querySelector(".placeholder").innerHTML=e("licence.html");Array.from(this._node.querySelectorAll("button, button + a")).forEach(function(b){return b.addEventListener("click",
a)})}m(d,a);b(d,[{key:"activate",value:function(){f(Object.getPrototypeOf(d.prototype),"activate",this).call(this);document.title=e("licence.title")}},{key:"handleEvent",value:function(a){a.preventDefault();a="accept"==a.target.getAttribute("data-purpose");h.request("/user/properties/licence",{confirmed:a},{method:"PUT"}).then(function(a){return g()},c)}}]);return d}(k);l("default",new a)}}});
System.register("view/login.js","./base.js util/net.js util/html.js app.js util/gettext.js ui/alert.js util/various.js conf.js util/error.js validators/base.js util/facebook.js util/neznam.js ui/password-changer.js ui/vcard.js util/keypair.js ./gdpr-unblock.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function k(a){var b=[],c;for(c in a)b.push([c,a[c]].map(encodeURIComponent).join("="));return b.join("&")}var h,e,g,c,a,b,f,d,n,p,q,r,t,v,u,z,y,w,B,A,x=function(){return function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done)&&(c.push(h.value),!b||c.length!==b);d=!0);}catch(J){e=!0,f=J}finally{try{if(!d&&
g["return"])g["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),C=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),D=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===
d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){h=a["default"]},function(a){e=a},function(a){g=a},function(a){c=a},function(c){a=c._;b=c.hastext},function(a){f=a["default"]},function(a){d=a.goContinue;n=a.parseSearch},function(a){p=a["default"]},function(a){q=a["default"]},function(a){r=a["default"]},function(a){t=a},function(a){v=a},function(a){u=a["default"]},function(a){z=a["default"]},
function(a){y=a["default"];w=a},function(a){B=a["default"]}],execute:function(){A=function(h){function l(){if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");D(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,"login");this._active=this._loaded=!1;this._username=this._node.querySelector("#login-username");this._password=this._node.querySelector("#login-password");this._submit=this._node.querySelector("form.login [type=submit]");this._domain=this._node.querySelector("select");
this._node.querySelector("form.login").addEventListener("submit",this);this._validators={username:new r(this._domain,this._username),password:new r(this._password,this._password)};window.addEventListener("load",this)}m(l,h);C(l,[{key:"showFacebook",value:function(){t.init();var a=document.querySelector("button.fb-login");a&&a.addEventListener("click",function(a){a.preventDefault();t.checkLoginState(function(a){c.setView("social-pair",{type:"facebook",token:a.accessToken})})})}},{key:"activate",value:function(){var a=
this;this._active=!0;w.isSupported().then(function(b){return a._keyPairSupported=b});var b=document.querySelector("header .login");b&&b.classList.add("hidden");this._setTitle();D(Object.getPrototypeOf(l.prototype),"activate",this).call(this);window.addEventListener("popstate",this);this._username.addEventListener("input",this);this._getAds();this._fromURL();p.allow_social&&this.showFacebook()}},{key:"deactivate",value:function(){var a=document.querySelector("header .login");a&&a.classList.remove("hidden");
D(Object.getPrototypeOf(l.prototype),"deactivate",this).call(this)}},{key:"handleEvent",value:function(a){a.preventDefault();switch(a.type){case "popstate":this._fromURL();break;case "input":this._setUsername(this._username.value);break;case "load":this._setUsername(this._username.value);this._loaded=!0;this._getAds();break;case "submit":for(var b in this._validators)this._validators[b].hide();p.confirmMail?this._submitEmail():this._submitLogin()}}},{key:"_disable",value:function(){this._submit.disabled=
!0}},{key:"_enable",value:function(){this._submit.disabled=!1}},{key:"_submitEmail",value:function(){var b=this,c={key:p.confirmMail.key,refresh:p.confirmMail.refresh,password:this._password.value};c.password?(this._disable(),e.request("/user/verified_email",c).then(function(a){return d()},function(a){return b._loginError(a)})):this._validators.password.show(a("login.validation.emptyPassword"))}},{key:"_submitLogin",value:function(){var b=this,c={username:this._username.value+this._domain.value,password:this._password.value,
service:p.service,return_url:p.return_url},d=c.username.split("@");d=x(d,2);var e=d[0];if(v.handlesDomain(d[1]))v.redirect(e);else if(this._username.value.length)if(1!=c.username.split("").filter(function(a){return"@"==a}).length)this._validators.username.show(a("login.validation.username")),this._username.focus();else if(c.password){this._disable();if(this._keyPairSupported&&(d=function(){var a=c.username,d=void 0,e=void 0;try{d=localStorage.getItem("browser_id-"+a),e=localStorage.getItem("keypair-"+
a)}catch(K){}if(d&&e)return{v:y.fromString(e).then(function(a){b._loginWithKeyPair(c,a,d)})}}(),"object"===typeof d))return d.v;this._sendLoginRequest(c)}else this._validators.password.show(a("login.validation.emptyPassword")),this._password.focus();else this._validators.username.show(a("login.validation.emptyUsername")),this._username.focus()}},{key:"_loginWithKeyPair",value:function(a,b,c){var d=this;e.request("/2fa/challenge",{device_id:c}).then(function(a){return a.challenge},function(a){return""}).then(function(a){return b.sign(a)}).then(function(b){a.browser_id=
c;a.signature=b;d._sendLoginRequest(a)})}},{key:"_sendLoginRequest",value:function(a){var b=this;e.request("/login",a).then(function(a){return b._loginDone(a)},function(a){return b._loginError(a)})}},{key:"_fromURL",value:function(){var b=this,d=(location.hash||location.pathname).split("/").pop(),f=location.search,g=d.indexOf("?");-1<g&&(f=d.substring(g),d=d.substring(0,g));f=n(f);g=f.username||"";p.uid=f.uid;switch(d){case "licence":c.setView("licence");break;case "avatar":c.setView("avatar");break;
case "secure":c.setView("secure",!1);break;case "refresh-secure":c.setView("refresh-secure",!1);break;case "social-pair":c.setView("social-pair");break;case "tfa":c.setView("tfa",{pin:"1"==f.pin,email:f.username,onDone:function(a){b._setUrl("/");c.setView("login");b._loginDone(a)}});break;case "weak-password":this._showPasswordChanger({"continue":!0,username:g,text:"weak"});document.title=a("login.title-password");break;case "too-weak-password":this._showPasswordChanger({"continue":!1,username:g,
text:"weak"});document.title=a("login.title-password");break;case "need-password-change":this._showPasswordChanger({"continue":!1,username:g,text:"forced",phone:!0,savedPhone:f.phone||""});document.title=a("login.title-password");break;case "password-change-request":this._showPasswordChanger({"continue":!0,username:g,text:"police"});document.title=a("login.title-police");break;case "service-blocked":this._setUsername(g,{disable:!0});this._showForm();this._validators.username.show(a("login.validation.blockedService"));
break;case "gdpr-user-blocked":this._showGDPRunblock(f);break;case "user-blocked":this._setUsername(g,{disable:!0});this._showForm();this._validators.username.show(a("login.validation.blocked"));break;case "bad-credentials":this._setUsername(g);this._showForm();this._validators.password.show(a("login.validation.password"));break;case "logged-users":e.request("/user/badge?"+Math.random(),null,{method:"GET"}).then(function(a){return a.users?b._showLogged(a,"manage"):b._showForm()},function(a){return b._showForm()});
break;default:document.title=a("login.title");this._setUsername(g,{disable:!0});p.confirmMail&&(this._username.disabled=!0,this._username.value=p.confirmMail.username,this._node.classList.add("confirm-email"),d=this._node.querySelector("h2"))&&(f=document.createElement("p"),f.appendChild(document.createTextNode(a("login.confirm"))),d.parentNode.replaceChild(f,d));if(p.query.relogin||p.query.username||p.confirmMail)return this._showForm();e.request("/user/badge?"+Math.random(),null,{method:"GET"}).then(function(a){return a.users?
b._showLogged(a,"continue"):b._showForm()},function(a){return b._showForm()})}}},{key:"_setUsername",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],c=a.indexOf("@");if(-1!=c){var d=a.substring(c),e=-1;Array.from(this._domain.options).forEach(function(a,b){a.value==d&&(e=b)});-1!=e?(this._username.value=a.substring(0,c),this._domain.value=d):(this._username.value!=a&&(this._username.value=a),this._domain.value="");b.disable&&this._username.value&&(this._username.disabled=
!0,this._domain.disabled=!0);this._password.style.display=v.handlesDomain(d.substring(1))?"none":""}}},{key:"_getAds",value:function(){if(this._loaded&&this._active){var a=this._node.querySelector("#ad");a&&window.im&&"oauth"!=p.service&&im.getAds([{id:a,zoneId:"seznam.login.medium.rectangle"}]);a&&window.sssp&&"oauth"!=p.service&&sssp.getAds({id:a.firstChild,zoneId:"62108",height:600,callback:function(b,c){sssp.writeAd(b,c);a.classList.toggle("adFull",a.firstChild.classList.contains("adFull"))}})}}},
{key:"_showForm",value:function(){var a=Array.from(this._node.querySelectorAll("form"));a[0].classList.remove("hidden");a[1].classList.add("hidden");a=this._username;a.disabled&&(a=this._password);/Android/i.test(navigator.userAgent)||a.focus()}},{key:"_showLogged",value:function(b,c){var d=this,e=document.body.querySelector("h1");switch(c){case "continue":e.textContent=a("login.logged.title");break;case "manage":e.textContent=a("login.logged.manage")}e=Array.from(this._node.querySelectorAll("form"));
e[1].classList.remove("hidden");e[0].classList.add("hidden");var f=e[1];f.classList.add(c);g.clear(f);b.users.forEach(function(a){f.appendChild(d._buildLoggedUser(a,a.isActive,c))});b.users.length||f.appendChild(this._buildLoggedUser(b,!0,c));10>b.users.length&&(e=g.node("div",{className:"new-user"},a("login.logged.new-user")),b=g.node("img",{src:"/static/img/user-plus.svg"}),e.insertBefore(b,e.firstChild),f.appendChild(e),e.addEventListener("click",function(a){return d._showForm()}));b=p.oauth&&
!p.oauth.internal;"manage"==c?(e=g.node("div",{className:"forget-all"},a("login.logged.forget-all")),b=g.node("img",{src:"/static/img/delete-gray.svg"}),e.insertBefore(b,e.firstChild),f.appendChild(e),e.addEventListener("click",function(a){return d._forgetAll()}),b=g.node("p"),e=g.node("a",{href:"https://napoveda.seznam.cz/cz/prihlasovani-vice-ucty/"},a("login.logged.help")),b.appendChild(e),f.appendChild(b)):b||(e=g.node("div",{className:"manage-users"},a("login.logged.manage")),b=g.node("img",{src:"/static/img/settings.svg"}),
e.insertBefore(b,e.firstChild),f.appendChild(e),e.addEventListener("click",function(a){return location.href="/logged-users"}))}},{key:"_buildLoggedUser",value:function(b,c,d){var e=this,f=z.fromBadge(b).node;switch(d){case "continue":f.addEventListener("click",function(a){return e._switchUser(b,c)});break;case "manage":d=g.node("img",{src:"/static/img/delete-red.svg"}),d.classList.add("forget"),d.title=a("login.logged.forget"),f.appendChild(d),d.addEventListener("click",function(a){return e._forgetUser(b)})}return f}},
{key:"_loginDone",value:function(a){this._enable();p.uid=a.uid;var b=p.oauth&&!p.oauth.internal,c={username:a.email,uid:a.uid};if(a.police_request)this._setUrl("/password-change-request",c);else if(a.valid_licence)if(a.avatar_invoke&&!b)p.avatar_url=a.avatar_url,p.email=a.email,this._setUrl("/avatar",c);else if(a.weak_password&&!b)this._setUrl("/weak-password",c);else if(a.secure_invoke&&!b)this._setUrl("/secure",c);else if(a.refresh_secure&&!b)this._setUrl("/refresh-secure",c);else return this._node.style.display=
"none",d();else this._setUrl("/licence",c);this._fromURL()}},{key:"_loginError",value:function(a){this._enable();a instanceof e.HTTPError&&400==a.status&&this._knownLoginError(a.response)||(a instanceof e.HTTPError&&300==a.status&&399==a.response.status?(this._setUrl("/tfa",{username:this._username.value+this._domain.value,pin:a.response.payload.pin?1:0}),this._fromURL()):q(a))}},{key:"_knownLoginError",value:function(b){var c=this,d={username:this._username.value.trim()+this._domain.value.trim()};
switch(b.status){case 401:case 499:this._setUrl("/bad-credentials",d);break;case 422:var e=!1;b.payload.form_errors.forEach(function(a){a.field in c._validators?c._validators[a.field].show(a.message):e=!0});if(e)return!1;break;case 496:this._setUrl("/too-weak-password",d);break;case 478:d.phone=b.payload.saved_phone;this._setUrl("/need-password-change",d);break;case 489:this._setUrl("/service-blocked",d);break;case 440:d.avatar_url=b.payload.avatar_url;d.fullname=b.payload.fullname;this._setUrl("/gdpr-user-blocked",
d);break;case 498:this._setUrl("/user-blocked",d);break;case 464:d={ok:a("alert.ok")};f(b.status+": Robot detected",d);break;default:return!1}this._fromURL();return!0}},{key:"_showGDPRunblock",value:function(a){a=new B(a.fullname,a.username,a.avatar_url);var b=this._node.querySelector("form");b.parentNode.replaceChild(a.getNode(),b);a.activate()}},{key:"_showPasswordChanger",value:function(a){document.body.classList.remove("login");document.body.classList.add("password-changer");a.onSuccess=function(){return d()};
a.onContinue=function(){return d()};a=new u(a);var b=this._node.querySelector("form");b.parentNode.replaceChild(a.getNode(),b)}},{key:"_setUrl",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],c=n(location.search);Object.assign(c,b);history.pushState(null,null,a+"?"+k(c))}},{key:"_switchUser",value:function(a,b){switch(a.state){case "green":b?d():e.request("/switch/"+a.userId,{},{prefix:""}).then(d);break;case "orange":this._setUsername(a.email,{disable:!0}),this._showForm()}}},
{key:"_forgetUser",value:function(a){e.request("/logout",{forget:!0,uid:a.userId}).then(function(a){return location.reload()},function(a){return location.reload()})}},{key:"_forgetAll",value:function(){e.request("/forget-all",{}).then(function(a){return location.reload()},function(a){return location.reload()})}},{key:"_setTitle",value:function(){var c=this._node.querySelector("h1"),d=this._node.querySelector("h2");if(p.oauth&&!p.oauth.internal)g.clear(d),d.textContent=a("oauth.to-service")+" "+p.oauth.name;
else switch((p.query.title||[]).shift()){case "2fa":g.clear(c);c.appendChild(g.text(a("login.title-tfa")));break;case "plain":break;case "zbozi-wallet":c.innerHTML="Administrace Zbo\u017e\u00ed.cz: Pen\u011b\u017eenka";break;case "zbozi-premise":c.innerHTML="Administrace Zbo\u017e\u00ed.cz: P\u0159ev\u00e9st provozovnu";break;case "zbozi-account":c.innerHTML="Administrace Zbo\u017e\u00ed.cz: P\u0159ev\u00e9st sv\u016fj \u00fa\u010det";break;default:d="service."+p.service,b(d)&&c.appendChild(document.createTextNode(" "+
a(d)))}}}]);return l}(h);l("default",new A)}}});
System.register("view/oauth.js","./base.js ui/vcard.js util/gettext.js util/net.js util/various.js conf.js util/error.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function k(a){var b=[];if(0==a.indexOf("r:"))a=
a.substring(2),a=g("oauth.service."+a),b.push(g("oauth.scope.service")+" "+a);else switch(a){case "2fa-pair":b.push("Zapnut\u00ed dvouf\u00e1zov\u00e9ho ov\u011b\u0159ov\u00e1n\u00ed");break;case "identity":b.push(g("oauth.scope.email"));b.push(g("oauth.scope.name"));break;default:b.push(a)}return b.map(function(a){var b=document.createElement("li");b.textContent=a;return b})}var h,e,g,c,a,b,f,d,n=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=
!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();return{setters:[function(a){h=a["default"]},function(a){e=a["default"]},function(a){g=a._},function(a){c=a},function(b){a=b.fullAvatarUrl},function(a){b=a["default"]},function(a){f=a["default"]}],execute:function(){d=function(d){function h(){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");a:{var a=Object.getPrototypeOf(h.prototype),b=
"constructor";var c=this;var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d){c=d.value;break a}b=d.get;c=void 0===b?void 0:b.call(c);break a}c=void 0}c.call(this,"oauth")}m(h,d);n(h,[{key:"activate",value:function(){var d=this;this._node.querySelector("form").addEventListener("submit",this);var f=b.oauth,h="/oauth/grant?client_id="+encodeURIComponent(f.client_id);f.scope&&(h=
h+"&scope="+encodeURIComponent(f.scope));c.request(h,null,{method:"GET"}).then(function(a){if(a.granted||a.internal)return d._submit();d._node.classList.remove("hidden");document.body.classList.add(d.getId());var b=a.client_name.replace(/</g,"&lt;"),c=d._node.querySelectorAll(".paper > p");c[0].innerHTML=g("oauth.description",b);c[1].innerHTML=g("oauth.legal",b);(b=c[1].querySelector("a"))&&a.gdprUrl&&(b.target="_blank",b.href=a.gdprUrl);var e=d._node.querySelector("ul");f.scope&&f.scope.split(",").forEach(function(a){k(a).forEach(function(a){return e.appendChild(a)})})},
function(a){return d._handleError(a)});c.request("/user?"+Math.random(),null,{method:"GET"}).then(function(b){var c=d._node.querySelector(".vcard-placeholder");new e(b.firstname||b.lastname?b.firstname+" "+b.lastname:"",b.username+"@"+b.domain,a(b.avatar_url),c)})}},{key:"handleEvent",value:function(a){switch(a.type){case "submit":a.preventDefault(),this._submit()}}},{key:"_submit",value:function(){var a=this;this._grant().then(function(b){return a._redirect({code:b.authorization_code})})["catch"](function(b){return a._handleError(b)})}},
{key:"_grant",value:function(){var a=b.oauth,d={client_id:a.client_id,redirect_uri:b.return_url};a.scope&&(d.scope=a.scope);return c.request("/oauth/grant",d)}},{key:"_redirect",value:function(){var a=0>=arguments.length||void 0===arguments[0]?{}:arguments[0];b.oauth.state&&(a.state=b.oauth.state);a=Object.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])});var c=b.return_url,d=-1<c.indexOf("?")?"&":"?";c=""+c+d+a.join("&");location.href=c}},{key:"_handleError",value:function(a){400==
a.status&&a.response.error?this._redirect({error:a.response.error,error_description:a.response.message}):f(a)}}]);return h}(h);l("default",new d)}}});
System.register("view/recover.js","./base.js util/net.js util/gettext.js conf.js util/error.js util/warning.js util/events.js validators/passwordmatch.js validators/password.js validators/email.js validators/birthyear.js validators/base.js validators/nonempty.js validators/emailserver.js ui/vcard.js util/various.js".split(" "),function(l){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function k(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h,e,g,c,a,b,f,d,n,p,q,r,t,v,u,z,y,w,B=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),A=function(a,b,c){var d=!0;for(;d;)if(null===
a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){h=a["default"]},function(a){e=a},function(a){g=a._},function(a){c=a["default"]},function(b){a=b["default"]},function(a){b=a["default"]},function(a){f=a["default"]},function(a){d=a["default"]},function(a){n=a["default"]},function(a){p=a["default"]},function(a){q=a["default"]},
function(a){r=a["default"]},function(a){t=a["default"]},function(a){v=a["default"]},function(a){u=a["default"]},function(a){z=a.fullAvatarUrl}],execute:function(){y=function(a){function b(a,c){m(this,b);A(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,!1);this.parent=c}k(b,a);B(b,[{key:"show",value:function(a){a||(a=g("recover.validation.same_email"));A(Object.getPrototypeOf(b.prototype),"show",this).call(this,a)}},{key:"validate",value:function(a){a=this._targetNode.value.trim();
var b=this.parent._email.trim();a=a!=b;this[a?"hide":"show"]();return Promise.resolve(a)}}]);return b}(p);w=function(h){function l(){function a(){v.disabled=u.checked}var c=this;m(this,l);A(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,"recover");this.debugStates=[];this._uid=-1;this._hasEbox=!1;this._selectedSkin=-1;this._events=void 0;this._screens={s0Intro:{id:"recover-intro",i:0,username:this._node.querySelector("form#recover-intro input[name='youremail']"),domain:this._node.querySelector("form#recover-intro select")},
s1Question:{id:"recover-question",i:1},s2Additional:{id:"recover-additional",i:2},s1Email:{id:"recover-email",i:1},s1Phone:{id:"recover-phone",i:1},s2SmsPin:{id:"recover-sms-pin",i:2},s2MailSent:{id:"recover-mail-sent",i:3},s25Keys:{id:"recover-keys",i:2},s3ReqSent:{id:"recover-req-sent",i:3},s3NewPass:{id:"recover-password",i:3,saveEmail:this._node.querySelector("input[name='save_email']")},s3BadTicket:{id:"recover-bad-ticket",i:3},s4Done:{id:"recover-done",i:4}};this._screenAlias={};this._questionData=
{};this._includeKeystrokes=!1;this._userCard=null;for(var e in this._screens)this._screens[e].node=this._node.querySelector("form#"+this._screens[e].id),this._screenAlias[this._screens[e].id]=e,this._screens[e].node.addEventListener("submit",this);this._screens.s1Email.warning=new b(this._screens.s1Email.node.querySelector("p"));e=this._screens.s1Phone.node.querySelector("input[name='phone']");this._screens.s1Phone.warning=new r(e,e);e=this._screens.s2SmsPin.node.querySelector("input[name='pin']");
this._screens.s2SmsPin.warning=new r(e,e);this._screens.s3NewPass.warning=new b(this._screens.s3NewPass.node.querySelector("input[type='password']"));e=this._screens.s3NewPass;var f=e.node.querySelectorAll("input[type='password']");e._validators={password:new n(f[0]),match:new d(f[1],f)};e=this._screens.s0Intro;e._validator=new r(e.domain,e.username);e.warning=e._validator;f=this._screens.s1Question;var h=f.node.querySelector("input[name='delivery-email']");f._validators={answer:new t(f.node.querySelector("input[name='answer']")),
birthYear:new q(f.node.querySelector("input[name='birth-year']")),email:new p(h),deliveryEmail:new y(h,this)};h=this._screens.s25Keys;var k=h.node.querySelector("input[name='delivery-email']");h._validators={email:new p(k),deliveryEmail:new y(k,this)};this._node.querySelector("div.info a").addEventListener("click",function(a){a.preventDefault();c.showState("s0Intro")});this._screens.s1Email.node.querySelector("a").addEventListener("click",function(a){a.preventDefault();c.showState("s1Phone")});this._screens.s1Phone.node.querySelector("a").addEventListener("click",
function(a){a.preventDefault();c.showState("s1Email")});this._screens.s1Phone.node.querySelector("a.skip").addEventListener("click",function(a){a.preventDefault();c.showState("s2SmsPin")});Array.from(this._screens.s2Additional.node.querySelectorAll("img")).forEach(function(a){var b=a.getAttribute("data-id");b&&a.setAttribute("title",g("recover.additional.skin_labels."+b));a.addEventListener("click",c._selectSkin())});h=this._addInput.bind(this);this._node.querySelector("fieldset#recover-addemail a").addEventListener("click",
h);this._node.querySelector("fieldset#recover-addemail input").addEventListener("input",h);this._node.querySelector("fieldset#recover-addfolder a").addEventListener("click",h);this._node.querySelector("fieldset#recover-addfolder input").addEventListener("input",h);Array.from(this._screens.s2Additional.node.querySelectorAll("input")).forEach(function(a){return a.addEventListener("input",c._switchButton.bind(c))});Array.from(this._screens.s2Additional.node.querySelectorAll("img")).forEach(function(a){return a.addEventListener("click",
c._switchButton.bind(c))});e.username.addEventListener("input",this._usernameDomain.bind(this));var u=f.node.querySelector("[type=checkbox]"),v=f.node.querySelector("[name='birth-year']");u.addEventListener("click",a);a()}k(l,h);B(l,[{key:"activate",value:function(a){document.title=g("recover.title");A(Object.getPrototypeOf(l.prototype),"activate",this).call(this);var b=this._screens.s0Intro,d=a.path;c.query.ticket?this.showState("s3NewPass"):void 0===d||0==d.length||0==d[0].length?this.showState("s0Intro"):
this.showState("recover-"+d[0]);a.username&&(b.username.value=a.username);a.domainIndex&&(b.domain.selectedIndex=a.domainIndex);this._fixLoginLink();window.addEventListener("popstate",this)}},{key:"handleEvent",value:function(a){var b=this;a.preventDefault();switch(a.type){case "popstate":this._fromURL(a.state);break;case "submit":switch(a.target){case this._screens.s0Intro.node:this._submitIntro();break;case this._screens.s1Question.node:this._answerQuestion();break;case this._screens.s2Additional.node:"question"==
c.keystrokes&&this._includeKeystrokes?this._extractAdditional().then(function(a){return b.showState("s25Keys")}):this._submitAdditional();break;case this._screens.s1Email.node:this._submitEmail();break;case this._screens.s1Phone.node:this._submitPhone();break;case this._screens.s2SmsPin.node:this._submitSmsPin();break;case this._screens.s3NewPass.node:this._submitNewPass();break;case this._screens.s4Done.node:this._screens.s4Done.node.submit();break;case this._screens.s25Keys.node:this._submitKeys()}}}},
{key:"showState",value:function(a){this.debugStates.push(a);if(a in this._screens)history.pushState({uid:this._uid},null,"/"+this._screens[a].id.replace("-","/"));else if(a in this._screenAlias)a=this._screenAlias[a];else{location.reload();return}"s0Intro"==a||"s3BadTicket"==a?this._node.querySelector("div.info").classList.add("hidden"):this._node.querySelector("div.info").classList.remove("hidden");"s2SmsPin"==a?this._screens.s2SmsPin.node.querySelector("input[name='pin']").value="":"s2Additional"==
a?this._switchButton():"s3NewPass"==a?(this._resetPassword(),this._grabTicket()):"s25Keys"==a&&(this._events=new f(document.querySelector("form#recover-keys h2"),4E3));for(var b in this._screens){var c=this._screens[b];c.node.classList.add("hidden");c.warning&&c.warning.hide()}this._screens[a].node.classList.remove("hidden");this._progressBar(this._screens[a].i);this._screens[a].warning&&(this._warning=this._screens[a].warning);0>this._uid&&"s0Intro"!=a&&window.DOT&&DOT.hit("error",{d:{message:"uid<0",
stack:this.debugStates.join()}})}},{key:"_fixLoginLink",value:function(){var a=this._node.querySelector(".login"),b=[],d;for(d in c.query){var e=c.query[d];b.push(encodeURIComponent(d)+"="+encodeURIComponent(e))}a.href+="?"+b.join("&")}},{key:"_fromURL",value:function(a){var b=(location.hash||location.pathname).split("/").pop();"recover"==b||"s0Intro"==b||"intro"==b?this.showState("recover-intro"):a&&a.uid!=this._uid?this.showState("recover-intro"):this.showState("recover-"+b)}},{key:"_progressBar",
value:function(a){a--;Array.from(this._node.querySelectorAll("div.info li")).forEach(function(b,c){c==a?b.classList.add("current"):b.classList.remove("current")})}},{key:"_addInput",value:function(a){var b=a.target.parentNode;"fieldset"!=b.nodeName.toLowerCase()&&(b=b.parentNode);if("click"==a.type)a.preventDefault();else if("input"==a.type&&Array.from(b.querySelectorAll("input")).some(function(a){return""==a.value}))return;a=b.querySelectorAll("input");a=a[a.length-1].cloneNode();a.addEventListener("input",
this._addInput.bind(this));a.addEventListener("input",this._switchButton.bind(this));a.value="";b.insertBefore(a,b.querySelector("a"))}},{key:"_switchButton",value:function(){var a=this._screens.s2Additional.node,b=Array.from(a.querySelectorAll("input")).every(function(a){return""==a.value});b=b&&0>this._selectedSkin;a=a.querySelector("button[type='submit']");a.innerHTML="";"question"==c.keystrokes&&this._includeKeystrokes?b?a.appendChild(document.createTextNode(g("recover.skip"))):a.appendChild(document.createTextNode(g("recover.continue"))):
b?a.appendChild(document.createTextNode(g("recover.skip_verify"))):a.appendChild(document.createTextNode(g("recover.verify")))}},{key:"_selectSkin",value:function(){return function(a){a.preventDefault();for(var b=this._node.querySelectorAll("img"),c=0;c<b.length;c++){var d=b.item(c);d==a.target?(d.classList.add("active"),this._selectedSkin=d.getAttribute("data-id")):d.classList.remove("active")}}.bind(this)}},{key:"_submitIntro",value:function(){var a=this,b=this._screens.s0Intro.node.querySelector("input[name='youremail']");
this._screens.s0Intro._validator.validate(!0).then(function(d){if(d){a._resetPhoneEmail();var f=a._screens.s1Question.node.querySelector("p strong");f.innerHTML="";d={email:b.value+a._screens.s0Intro.domain.value};if(-1==d.email.indexOf("@"))a._warning.show(g("login.validation.username"));else if(d.email.indexOf("@")+1==d.email.length)a._warning.show(g("recover.validation.email"));else{var h=a._node.querySelector("div.info div.vcard-placeholder");a._userCard&&a._userCard.destroy();a._userCard=new u("",
d.email,null,h);a._email=d.email;e.request("/recover/request",d,{method:"PUT"}).then(function(b){a._uid=b.uid;a._hasEbox=b.hasEbox;b.email&&(a._screens.s1Email.node.querySelector("p strong").appendChild(document.createTextNode(b.email)),a._screens.s1Phone.node.querySelector("a").style.display="block");b.phone&&(a._phonePrefix=b.phone,a._screens.s1Phone.node.querySelector(".phone-number span").appendChild(document.createTextNode(a._phoneInsertSpaces(b.phone))),a._screens.s1Email.node.querySelector("a").style.display=
"block");b.question&&(f.appendChild(document.createTextNode(b.question)),a._node.querySelector("div.new-skin").classList.remove("hidden"));a._includeKeystrokes=b.keystrokes?!0:!1;b.managed?a._warning.show(g("recover.ask_admin")):b.email?a.showState("s1Email"):b.phone?a.showState("s1Phone"):b.question?a.showState("s1Question"):"off"!=c.keystrokes&&b.keystrokes?a.showState("s25Keys"):a._warning.show(g("recover.no_recovery"))},function(b){return a._recoveryError(b)})}}})}},{key:"_answerQuestion",value:function(){var a=
this,b=this._screens.s1Question.node,c=Object.keys(this._screens.s1Question._validators).map(function(b){return a._screens.s1Question._validators[b].validate(!0)});Promise.all(c).then(function(c){c.every(function(a){return a})&&(c=b.querySelector("input[name='birth-year']"),a._questionData={uid:a._uid,answer:b.querySelector("input[name='answer']").value.trim(),birth_year:c.disabled?"1899":c.value,delivery_email:b.querySelector("input[name='delivery-email']").value.trim()},(new v(b.querySelector("input[name='delivery-email']"),
b.querySelector("input[name='delivery-email']").parentNode)).validate().then(function(b){b&&(a._hasEbox?a.showState("s2Additional"):a._submitAdditional())}))})}},{key:"_extractAdditional",value:function(){var a=this._screens.s2Additional.node,b=Array.from(a.querySelectorAll("fieldset#recover-addemail input")).map(function(a){return a.value.trim()}).filter(function(a){return""!=a});a=Array.from(a.querySelectorAll("fieldset#recover-addfolder input")).map(function(a){return a.value.trim()}).filter(function(a){return""!=
a});b={uid:this._uid,emails:b,folders:a,skin:this._selectedSkin};return this._questionData=b=Object.assign(b,this._questionData)}},{key:"_submitAdditional",value:function(){var a=this,b=Array.from(this._node.querySelectorAll("[type=submit]")),c=this._extractAdditional();b.forEach(function(a){return a.disabled=!0});e.request("/recover/additional",c,{method:"PUT"}).then(function(b){return a.showState("s3ReqSent")},function(b){return a._recoveryError(b)}).then(function(){b.forEach(function(a){return a.disabled=
!1})})}},{key:"_submitEmail",value:function(){var a=this;e.request("/recover/email",{uid:this._uid},{method:"PUT"}).then(function(b){return a.showState("s2MailSent")},function(b){return a._recoveryError(b)})}},{key:"_submitPhone",value:function(){var a=this,b=this._screens.s1Phone.node.querySelector("input[name='phone']").value;b.match(/^\d{3}$/)?(this._phone=this._phonePrefix+b,e.request("/recover/sms",{uid:this._uid,phone:this._phone},{method:"PUT"}).then(function(b){return a.showState("s2SmsPin")},
function(b){return a._recoveryError(b)})):this._warning.show(g("recover.phone.bad_phone"))}},{key:"_submitSmsPin",value:function(){var a=this,b=this._screens.s2SmsPin.node.querySelector("input[name='pin']");e.request("/recover/pin",{uid:this._uid,phone:this._phone,pin:b.value},{method:"PUT"}).then(function(b){a._ticket=b.ticket;a._recoveryMethod="phone";a.showState("s3NewPass")},function(b){return a._recoveryError(b)})}},{key:"_submitNewPass",value:function(){var a=this,b=Object.keys(this._screens.s3NewPass._validators).map(function(b){return a._screens.s3NewPass._validators[b].validate(!0)});
Promise.all(b).then(function(b){b.every(function(a){return a})&&a._setNewPass()})}},{key:"_setNewPass",value:function(){var a=this,b=this._screens.s3NewPass.saveEmail.checked?!0:!1;b={ticket:this._ticket,method:this._recoveryMethod,new_password:this._screens.s3NewPass.node.querySelector("input[type='password']").value,keep_proposed_email:b};e.request("/recover/new-pass",b,{method:"POST"}).then(function(b){return a.showState("s4Done")},function(b){return a._recoveryError(b)})}},{key:"_submitKeys",
value:function(){var a=this,b=this._events.getData().key;b=b.map(function(a){var b=a.ts;a:{switch(a.t){case "keydown":var c=0;break a;case "keyup":c=1;break a;case "keypress":c=2;break a}c=void 0}return[b,c,a.key,a.char]});var c=this._screens.s25Keys.node.querySelector("textarea[name='keys-sample']").value,d=Object.keys(this._screens.s25Keys._validators).map(function(b){return a._screens.s25Keys._validators[b].validate(!0)});Promise.all(d).then(function(d){d.every(function(a){return a})&&(d={uid:a._uid,
delivery_email:a._screens.s25Keys.node.querySelector("input[name='delivery-email']").value.trim(),key_data_str:JSON.stringify(b),user_text:c},d=Object.assign(d,a._questionData),e.request("/recover/keys",d,{method:"POST"}).then(function(b){return a.showState("s3ReqSent")},function(b){return a._recoveryError(b)}))})}},{key:"_grabTicket",value:function(){var a=c.query.ticket;a&&(this._ticket=a[0],this._recoveryMethod="email",this._checkTicket())}},{key:"_checkTicket",value:function(){var a=this;e.request("/recover/check-ticket",
{ticket:this._ticket},{method:"POST"}).then(function(b){var c=b.username+"@"+b.domain,d=a._node.querySelector("div.info div.vcard-placeholder");a._userCard=new u("",c,z(b.avatar_url),d);b.proposed_verify_email&&(b=document.createTextNode(g("recover.password.save_email",b.proposed_verify_email)),a._screens.s3NewPass.saveEmail.parentNode.querySelector("span").appendChild(b),a._screens.s3NewPass.saveEmail.parentNode.classList.remove("hidden"));a._screens.s3NewPass._validators.password.setUsername(c)},
function(b){return a.showState("s3BadTicket")})}},{key:"_resetPhoneEmail",value:function(){this._screens.s1Email.node.querySelector("p strong").innerHTML="";this._screens.s1Email.node.querySelector("a").style.display="none";this._phonePrefix="";this._screens.s1Phone.node.querySelector(".phone-number span").innerHTML="";this._screens.s1Phone.node.querySelector("a").style.display="none";this._screens.s1Phone.node.querySelector("input").value=""}},{key:"_resetPassword",value:function(){Array.from(this._screens.s3NewPass.node.querySelectorAll("input")).forEach(function(a){a.value=
""})}},{key:"_usernameDomain",value:function(){var a=this._screens.s0Intro,b=a.username.value,c=b.indexOf("@");if(-1!=c){var d=b.substring(c),e=-1;Array.from(a.domain.options).forEach(function(a,b){a.value==d&&(e=b)});-1!=e?(a.username.value=b.substring(0,c),a.domain.value=d):a.domain.value=""}}},{key:"_phoneInsertSpaces",value:function(a){for(var b=[],c=a.length-3;0<=c;)b.push(a.substr(c,3)),c-=3;b.push(a.substr(0,c+3));return b.reverse().join(" ")}},{key:"_recoveryError",value:function(b){b instanceof
e.HTTPError&&400==b.status?this._knownRecoveryError(b.response):a(b)}},{key:"_knownRecoveryError",value:function(a){switch(a.status){case 422:this._warning.show(g(a.payload.form_errors[0].message));break;case 455:this._warning.show(g("secure.validation.phone.sms_fail"));break;case 458:this._warning.show(g("recover.email.no_email"));break;case 459:this._warning.show(g("recover.phone.too_many_guesses"));break;case 465:this._warning.show(g("secure.validation.phone.sms_delay"));break;case 469:this._warning.show(g("recover.same_email"));
break;case 471:this._warning.show(g("recover.ticket.bad"));break;case 472:this._warning.show(g("secure.validation.phone.too_many_guesses"));break;case 473:this._warning.show(g("secure.validation.phone.bad_pin"));break;case 474:case 478:this._warning.show(g("recover.no_recovery"));break;case 498:this._warning.show(g("login.validation.blocked"));break;case 475:this._warning.show(g("recover.user_not_exists"));break;case 443:case 481:this._warning.show(g("secure.validation.phone.too_many"));break;case 482:this._warning.show(g("recover.phone.bad_phone"));
break;case 492:this._warning.show(g("register.validation.password.historic"));break;case 495:this._warning.show(g("recover.email.too_many"));break;case 496:this._warning.show(g("register.validation.password.weak"))}}}]);return l}(h);l("default",new w)}}});
System.register("view/recover-mailcz.js","./base.js util/net.js util/gettext.js conf.js util/error.js ui/vcard.js util/various.js validators/passwordmatch.js validators/password.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}var k,h,e,g,c,a,b,f,d,n,p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),q=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;
return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a},function(a){e=a._},function(a){g=a["default"]},function(a){c=a["default"]},function(b){a=b["default"]},function(a){b=a.fullAvatarUrl},function(a){f=a["default"]},function(a){d=a["default"]}],execute:function(){n=function(k){function l(){var a=this;if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");q(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,"recover-mailcz");
this._ticket="";this._form=this._node.querySelector("form");this._done=this._node.querySelector(".done");var b=this._form.querySelectorAll("[type=password]");this._validators={password:new d(b[0]),match:new f(b[1],b)};this._form.addEventListener("submit",function(b){return a._onSubmit(b)});this._form.querySelector("[type=checkbox]").addEventListener("click",function(b){return a._syncSubmit()});this._syncSubmit()}m(l,k);p(l,[{key:"activate",value:function(){this._form.hidden=!0;this._done.hidden=!0;
this._node.classList.remove("hidden");document.body.classList.add(this.getId());for(var a=document.body.querySelector("footer p:last-child a"),b=a.parentNode;a.nextSibling;)b.removeChild(a.nextSibling);b.parentNode.insertBefore(b,b.parentNode.firstChild);g.query.ticket?(this._ticket=g.query.ticket[0],this._checkTicket()):c(e("recover.ticket.bad"))}},{key:"_syncSubmit",value:function(){var a=this._form.querySelector("[type=checkbox]");this._form.querySelector("[type=submit]").disabled=!a.checked}},
{key:"_onSubmit",value:function(a){var b=this;a.preventDefault();a=[this._validators.password.validate(!0),this._validators.match.validate(!0)];Promise.all(a).then(function(a){a.every(function(a){return a})&&b._setNewPass()})}},{key:"_setNewPass",value:function(){var a=this,b=this._form.querySelector("[type=password]").value;h.request("/recover/new-pass",{ticket:this._ticket,method:"email",new_password:b,keep_proposed_email:!1},{method:"POST"}).then(function(b){return a._showDone()},function(b){return a._error(b)})}},
{key:"_showDone",value:function(){this._form.hidden=!0;this._done.hidden=!1;this._node.querySelector("h1").textContent="Heslo bylo nastaveno"}},{key:"_checkTicket",value:function(){var a=this;h.request("/recover/check-ticket",{ticket:this._ticket},{method:"POST"}).then(function(b){return a._buildForm(b)},function(b){return a._error(b)})}},{key:"_buildForm",value:function(c){this._form.hidden=!1;var d=c.username+"@"+c.domain;c=b(c.avatar_url);var e=new a("",d,c);this._form.insertBefore(e.node,this._form.firstChild);
e=new a("",d,c);this._done.insertBefore(e.node,this._done.firstChild);this._validators.password.setUsername(d);history.replaceState(null,"","/recover")}},{key:"_error",value:function(a){a instanceof h.HTTPError&&400==a.status?this._knownError(a.response):c(a)}},{key:"_knownError",value:function(a){switch(a.status){case 471:c(e("recover.ticket.bad"));break;case 498:c(e("login.validation.blocked"));break;case 492:this._validators.password.show(e("register.validation.password.historic"));break;case 495:c(e("recover.email.too_many"));
break;case 496:this._validators.password.show(e("register.validation.password.weak"))}}}]);return l}(k);l("default",new n)}}});
System.register("view/refresh-secure.js",["./base.js","ui/secure.js","util/various.js"],function(l){function m(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}var k,h,e,g,c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=
d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),a=function(a,c,d){var b=!0;for(;b;)if(null===a&&(a=Function.prototype),b=Object.getOwnPropertyDescriptor(a,c),void 0===b){a=Object.getPrototypeOf(a);if(null===a)break;b=!0}else{if("value"in b)return b.value;c=b.get;return void 0===c?void 0:c.call(d)}};return{setters:[function(a){k=a["default"]},function(a){h=a["default"]},function(a){e=
a.goContinue}],execute:function(){g=function(b){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");a(Object.getPrototypeOf(f.prototype),"constructor",this).call(this,"refresh-secure")}m(f,b);c(f,[{key:"activate",value:function(){this._node.querySelector("a.button").addEventListener("click",function(a){a.preventDefault();e()});this._secure=new h({refresh:!0});var b=this._node.querySelector("p");b.parentNode.insertBefore(this._secure.getNode(),b.nextSibling);
a(Object.getPrototypeOf(f.prototype),"activate",this).call(this)}}]);return f}(k);l("default",new g)}}});
System.register("view/register-done.js",["./base.js","util/gettext.js","conf.js","app.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g,c,a,b=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];
d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a._;e=a.hastext},
function(a){g=a["default"]},function(a){c=a}],execute:function(){a=function(a){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");f(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,"register-done");this._secure=!1;this._cachedPassword=null}m(d,a);b(d,[{key:"activate",value:function(){var a=0>=arguments.length||void 0===arguments[0]?{}:arguments[0],b=a.secure;a=a.cachedPassword;this._secure=b;this._cachedPassword=void 0===a?null:a;a=this._node.querySelector("a");
var c=this._node.querySelector("p");if(b)b=h("register.done.continue-secure"),a.appendChild(document.createTextNode(b)),b=h("register.done.subtitle-secure");else{var k="service."+g.service;b=h("register.done.continue");e(k)&&(b=b+" "+h(k));a.appendChild(document.createTextNode(b));b=h("register.done.subtitle")}c.innerHTML=b;a.addEventListener("click",this);a.href=g.registerContinue;f(Object.getPrototypeOf(d.prototype),"activate",this).call(this)}},{key:"handleEvent",value:function(a){this._secure&&
(a.preventDefault(),c.setView("secure",{afterReg:!0,cachedPassword:this._cachedPassword}))}}]);return d}(k);l("default",new a)}}});
System.register("view/register.js","./base.js ui/captcha.js validators/passwordmatch.js validators/password.js validators/username.js validators/birthyear.js util/net.js app.js util/error.js conf.js ui/alert.js util/gettext.js util/various.js util/events.js util/sf.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g,c,a,b,f,d,n,p,q,r,t,v,u,z=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),y=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=
Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a["default"]},function(a){e=a["default"]},function(a){g=a["default"]},function(a){c=a["default"]},function(b){a=b["default"]},function(a){b=a},function(a){f=a},function(a){d=a["default"]},function(a){n=a["default"]},function(a){p=a["default"]},function(a){q=a._},function(a){r=a.parseSearch},function(a){t=a["default"]},
function(a){v=a["default"]}],execute:function(){u=function(k){function l(){var a=this;if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");y(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,"register");this._captcha=null;this._passwords=this._node.querySelectorAll("input[type=password]");this._username=this._node.querySelector("#register-username");this._domain=this._node.querySelector("select");this._year=this._node.querySelector("#register-year");this._sexInputs=
Array.from(this._node.querySelectorAll("[type=radio]"));this._modeSwitch=this._node.querySelector(".mode-switch");this._mode="official";this._modeSwitch.querySelector("a").addEventListener("click",function(b){return a._toggleMode()});this._cachedPassword=null;this._fp2={hash:"",components:""};var b=this._node.querySelector("form.sent");b.classList.add("hidden");b.querySelector("a").addEventListener("click",this)}m(l,k);z(l,[{key:"activate",value:function(){var b=this;if(!this._captcha&&n.captcha){this._captcha=
new h(n.captcha);var d=this._node.querySelector("[type=submit]");d.parentNode.insertBefore(this._captcha.getNode(),d)}document.title=q("register.title");(new Fingerprint2({})).get(function(a,c){return b._fp2={hash:a,components:c}});this._validators={match:new e(this._passwords[1],this._passwords),password:new g(this._passwords[0],this._username,this._domain),username:new c(this._username,this._domain),year:new a(this._year)};this._node.querySelector("form.main").addEventListener("submit",this);this._username.addEventListener("input",
this);this._events=new t(document.querySelector("#register h1"));d=r(location.search);this._username.value=d.username||"";this._setMode("official");this._syncUsername();y(Object.getPrototypeOf(l.prototype),"activate",this).call(this)}},{key:"toggleFake",value:function(){var a=this,b=this._node.querySelector("#fake");b?b.parentNode.removeChild(b):(b=document.createElement("button"),b.id="fake",b.innerHTML="\u2665 FAKE IT BEJBE \u2665",b.style.backgroundColor="pink",b.style.display="block",b.onclick=
function(b){a._username.value="u"+Math.random().toString().replace(/\D/g,"");a._passwords[0].value=a._passwords[1].value="wtfomglol"},this._node.insertBefore(b,this._node.firstChild))}},{key:"handleEvent",value:function(a){var b=this;a.preventDefault();switch(a.type){case "input":this._syncUsername();break;case "click":case "submit":a=Object.keys(this._validators).map(function(a){return b._validators[a].validate(!0)}),Promise.all(a).then(function(a){a.every(function(a){return a})&&b._doRegister()})}}},
{key:"_syncUsername",value:function(){var a=this._username.value,b=a.indexOf("@");if(-1!=b){var c=a.substring(b),d=-1;Array.from(this._domain.options).forEach(function(a,b){a.value==c&&(d=b)});-1!=d?this._setMode("official"):this._setMode("own")}}},{key:"_setMode",value:function(a){this._mode=a;this._node.setAttribute("data-mode",a);a=this._modeSwitch.querySelector("span");var b=this._modeSwitch.querySelector("a");switch(this._mode){case "official":this._domain.value||(this._domain.selectedIndex=
0);var c=this._username.value,d=c.indexOf("@");0<d&&(this._username.value=c.slice(0,d));a.textContent=q("register.mode.askOwn");b.textContent=q("register.mode.goOwn")+".";break;case "own":this._domain.value="",a.textContent="",b.textContent=q("register.mode.goOfficial")}}},{key:"_toggleMode",value:function(){this._setMode("official"==this._mode?"own":"official")}},{key:"_doRegister",value:function(){var a=this,c=this._node.querySelector("[type=submit]");c.disabled=!0;var d=this._passwords[0].value;
this._cachedPassword=d;var e=new v({ua:!1,log:!1});d={username:""+this._username.value+this._domain.value,password:d,service:n.service,return_url:n.return_url,events:this._events.getData(),fp:{text:e.get({text:!0,canvas:!1}),canvas:e.get({text:!1,canvas:!0})},fp2:this._fp2};this._year.value&&(d.year=this._year.value);if(e=this._sexInputs.filter(function(a){return a.checked})[0])d.sex=e.value;this._captcha&&(d.captcha_code=this._captcha.getValue(),d.captcha_hash=this._captcha.getHash());e="/user";
var f=this._node.querySelector("[name='register.key']");f&&(e="/prefilleduser",d.key=f.value);n.uid=null;b.request(e,d).then(function(b){return a._registerDone(b)},function(b){return a._registerError(b)}).then(function(){return c.disabled=!1})}},{key:"_registerDone",value:function(a){a.location&&(n.registerContinue=a.location);299==a.status?(this._node.classList.add("sent"),this._node.querySelector("form.main").classList.add("hidden"),this._node.querySelector("form.sent").classList.remove("hidden")):
a.secure_invoke?f.setView("register-done",{secure:!0,cachedPassword:this._cachedPassword}):n.oauth?f.setView("oauth"):f.setView("register-done",{secure:!1})}},{key:"_registerError",value:function(a){a instanceof b.HTTPError&&400==a.status?this._knownRegisterError(a.response)||d(a):d(a)}},{key:"_knownRegisterError",value:function(a){var b=this;switch(a.status){case 464:a=q("register.robot");p(a,{ok:q("alert.ok")});break;case 467:this._captcha.showError();break;case 422:var c={year:"year"};a.payload.form_errors.forEach(function(a){a.field in
c&&b._validators[c[a.field]].show(a.message)});break;default:return!1}return!0}}]);return l}(k);l("default",new u)}}});
System.register("view/secure.js","./base.js util/error.js util/gettext.js conf.js util/net.js validators/base.js util/various.js ui/phone.js ui/email.js ui/vcard.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=
b)}var k,h,e,g,c,a,b,f,d,n,p,q,r,t=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===
b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a["default"]},function(a){e=a._;g=a.hastext},function(a){c=a["default"]},function(b){a=b},function(a){b=a["default"]},function(a){f=a.fullAvatarUrl;d=a.goContinue},function(a){n=a["default"]},function(a){p=a["default"]},function(a){q=a["default"]}],execute:function(){r=function(k){function l(){if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");v(Object.getPrototypeOf(l.prototype),"constructor",
this).call(this,"secure");this._email=this._phone=null;this._nav=Array.from(this._node.querySelectorAll("ul li"));this._done=this._node.querySelector(".done");this._good=this._done.querySelector(".good");this._bad=this._done.querySelector(".bad");this._confirm=this._bad.querySelector("[type=checkbox]");this._confirm.checked=!1;this._validator=new b(this._confirm.parentNode.lastChild);this._placeholders={phone:this._node.querySelector(".placeholder-phone"),email:this._node.querySelector(".placeholder-email"),
good:this._good.querySelector(".placeholder"),bad:this._bad.querySelector(".placeholder")};this._skip={phone:this._placeholders.phone.querySelector("a"),email:this._placeholders.email.querySelector("a")}}m(l,k);t(l,[{key:"activate",value:function(b){var d=this;v(Object.getPrototypeOf(l.prototype),"activate",this).call(this);var f=b.afterReg;b=b.cachedPassword;b=void 0===b?null:b;document.title=e("secure.title");this._node.classList.add(f?"register":"login");this._phone=new n({onStateChange:function(a){return d._stateChange("phone",
a)},cachedPassword:b});this._skip.phone.addEventListener("click",function(a){return d._skipPhone(a)});this._email=new p({onStateChange:function(a){return d._stateChange("email",a)}});this._skip.email.addEventListener("click",function(a){return d._skipEmail(a)});this._navTo("phone");a.request("/user",null,{method:"GET"}).then(function(a){return d._userData(a)},h);f=e("secure.continue");b="service."+c.service;g(b)&&(f+=" "+e(b));b=this._done.querySelector(".continue");b.appendChild(document.createTextNode(f));
b.addEventListener("click",this)}},{key:"handleEvent",value:function(a){switch(a.type){case "click":a=this._phone.getState();var b=this._email.getState(),c=!1;if("done"==a||"done"==b||"sent"==b)c=!0;c||this._confirm.checked?d():this._validator.show(e("secure.done.warning"))}}},{key:"_navTo",value:function(a){this._nav.forEach(function(a){return a.classList.remove("current")});var b=void 0;switch(a){case "phone":this._nav[0].classList.add("current");this._nav[0].classList.remove("bad");this._done.style.display=
"none";this._placeholders.email.style.display="none";b=this._placeholders.phone;b.insertBefore(this._phone.getNode(),b.firstChild);b.style.display="";this._phone.setState("phone");break;case "email":this._nav[1].classList.add("current");this._nav[1].classList.remove("bad");this._done.style.display="none";this._placeholders.phone.style.display="none";b=this._placeholders.email;b.insertBefore(this._email.getNode(),b.firstChild);b.style.display="";this._email.setState("email");break;case "done":this._nav[2].classList.add("current"),
this._placeholders.phone.style.display="none",this._placeholders.email.style.display="none",this._done.style.display="",this._good.style.display="none",this._bad.style.display="none","done"==this._phone.getState()||"done"==this._email.getState()||"sent"==this._email.getState()?(this._good.style.display="",this._bad.style.display="none",b=this._placeholders.good,"done"==this._phone.getState()&&b.appendChild(this._phone.getNode()),"done"!=this._email.getState()&&"sent"!=this._email.getState()||b.appendChild(this._email.getNode())):
(this._phone.setState("inactive"),this._email.setState("inactive"),this._good.style.display="none",this._bad.style.display="",b=this._placeholders.bad,b.appendChild(this._phone.getNode()),b.appendChild(this._email.getNode()))}}},{key:"_skipPhone",value:function(a){a.preventDefault();this._nav[0].classList.add("bad");this._navTo("email")}},{key:"_skipEmail",value:function(a){a.preventDefault();"sent"==this._email.getState()?(this._nav[1].classList.remove("bad"),this._nav[1].classList.add("good")):
this._nav[1].classList.add("bad");this._navTo("done")}},{key:"_userData",value:function(a){var b=this._node.querySelector(".vcard-placeholder");new q(a.firstname+" "+a.lastname,a.username+"@"+a.domain,f(a.avatar_url),b);b=a.verified_phone;a=a.verified_email;b&&this._phone.setValue(b);a&&this._email.setValue(a)}},{key:"_stateChange",value:function(a,b){if("phone"==b)return this._navTo("phone");if("email"==b)this._navTo("email"),this._skip.email.classList.remove("button"),this._skip.email.innerHTML=
"",this._skip.email.appendChild(document.createTextNode(e("secure.email.skip")));else if("sent"==b)this._skip.email.classList.add("button"),this._skip.email.innerHTML="",this._skip.email.appendChild(document.createTextNode(e("secure.email.continue")));else if("done"==b)switch(a){case "phone":this._nav[0].classList.remove("bad");this._nav[0].classList.add("good");this._navTo("email");break;case "email":this._nav[1].classList.remove("bad"),this._nav[1].classList.add("good"),this._navTo("done")}}}]);
return l}(k);l("default",new r)}}});
System.register("view/social-pair.js","./base.js util/error.js util/net.js app.js util/gettext.js conf.js ui/alert.js util/various.js ui/vcard.js ./social-screens.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=
b)}var k,h,e,g,c,a,b,f,d,n,p,q,r=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),t=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===
b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a["default"]},function(a){e=a},function(a){g=a},function(a){c=a._},function(b){a=b["default"]},function(a){b=a["default"]},function(a){f=a.goContinue},function(a){d=a["default"]},function(a){n=a.PairScreen;p=a.RegisterScreen}],execute:function(){q=function(k){function l(){var a=this;if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");t(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,
"social-pair");this._active=!1;this._screens={pair:new n(this,this._node.querySelector("form.pair")),register:new p(this,this._node.querySelector("form.register"))};this._domain=this._username="";this._node.querySelector("a.login-recover").addEventListener("click",function(b){b.preventDefault();b=Array.from(document.querySelectorAll("section#login option"));var c=b.length-1;b.forEach(function(b,d){b.value=="@"+a._domain&&(c=d)});g.setView("recover",{username:c<b.length-1?a._username:a._username+"@"+
a._domain,domainIndex:c})})}m(l,k);r(l,[{key:"activate",value:function(a){this._node.classList.remove("hidden");document.body.classList.add(this.getId());this._active=!0;a||(window.location="/");this._options=a;(a=document.querySelector("header .login"))&&a.classList.add("hidden");window.addEventListener("popstate",function(a){a.preventDefault();location.reload()});this._resolve()}},{key:"deactivate",value:function(){t(Object.getPrototypeOf(l.prototype),"deactivate",this).call(this);this.active=!1;
var a=document.querySelector("header .login");a&&a.classList.remove("hidden")}},{key:"_resolve",value:function(){var a=this,b={token:this._options.token,type:this._options.type};"neznam"==b.type&&(b.redirect_uri=location.href.replace(/&code=.*/,""));e.request("/social/resolve",b).then(function(b){return a._resolveResponse(b)},function(b){return a._processError(b)})}},{key:"_resolveResponse",value:function(a){var b=this._node.querySelector(".vcard-placeholder");(new d(a.sn_name,a.sn_email,a.sn_picture,
b)).node.classList.add(this._options.type);"neznam"==this._options.type&&(this._options.token=a.sn_token);a.paired?(a=a.sn_email.split("@"),this._username=a[0],this._domain=a[1],this.login()):a.uid?this._setScreen("pair"):this._setScreen("register")}},{key:"login",value:function(){var b=this;e.request("/social/login",{type:this._options.type,token:this._options.token,service:a.service}).then(function(b){a.uid=b.uid;f()},function(a){return b._processError(a)})}},{key:"_setScreen",value:function(a){for(var b in this._screens)b==
a?this._screens[b].show(this._options):this._screens[b].hide()}},{key:"_processError",value:function(a){if(a instanceof e.HTTPError&&400==a.status)switch(a.response.status){case 401:return b(c("social.verification_fail"),{ok:c("alert.ok")}).then(function(){return location.href="/"});case 445:return this._setScreen("register");case 446:return this._setScreen("pair");case 461:return b(c("social.unusable_user"),{ok:c("alert.ok")});case 449:return b("Na c\u00edlovou slu\u017ebu nen\u00ed povolen\u00e9 p\u0159ihl\u00e1\u0161en\u00ed pomoc\u00ed t\u0159et\u00ed strany.",
{ok:c("alert.ok")}).then(function(){return location.href="/"})}h(a)}}]);return l}(k);l("default",new q)}}});
System.register("view/social-screens.js",["util/error.js","util/net.js","util/gettext.js","validators/base.js","validators/birthyear.js"],function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}var h,e,g,c,a,b,f,d,n=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,
d);return b}}();return{setters:[function(a){h=a["default"]},function(a){e=a},function(a){g=a._},function(a){c=a["default"]},function(b){a=b["default"]}],execute:function(){b=function(){function a(b,c){k(this,a);this._owner=b;this._node=c;this._h1=c.querySelector("h1");this._h2=c.querySelector("h2")}p(a,[{key:"show",value:function(a){this._options=a;this._h1.classList.add("hidden");this._h2.classList.add("hidden");a=document.querySelector("header");a.querySelector("h1").textContent=this._h1.textContent;
a.querySelector("h2").textContent=this._h2.textContent;this._node.classList.remove("hidden")}},{key:"hide",value:function(){this._node.classList.add("hidden")}}]);return a}();f=function(a){function b(a,d){var e=this;k(this,b);n(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,d);this._password=this._node.querySelector("input[type='password']");this._validator=new c(this._password,this._password);this._node.addEventListener("submit",function(a){return e.submit(a)})}m(b,a);p(b,[{key:"submit",
value:function(a){var b=this;a.preventDefault();a={type:this._options.type,token:this._options.token,password:this._password.value};this._validator.hide();e.request("/social/pair",a).then(function(a){b._owner.login()},function(a){b._error(a.response)})}},{key:"_error",value:function(a){switch(a.status){case 401:this._validator.show(g("social.pair.bad_pass"));break;default:h(a)}}}]);return b}(b);l("PairScreen",f);d=function(b){function c(b,d){var e=this;k(this,c);n(Object.getPrototypeOf(c.prototype),
"constructor",this).call(this,b,d);this._birthYear=d.querySelector("div.year input");this._sexInputs=Array.from(this._node.querySelectorAll("[type=radio]"));this._validators=[new a(this._birthYear)];this._node.addEventListener("submit",function(a){return e.submit(a)})}m(c,b);p(c,[{key:"submit",value:function(a){var b=this;a.preventDefault();a=this._validators.map(function(a){return a.validate(!0)});Promise.all(a).then(function(a){if(a.every(function(a){return a})){a={type:b._options.type,token:b._options.token};
b._birthYear.value&&(a.year=b._birthYear.value);var c=b._sexInputs.filter(function(a){return a.checked})[0];c&&(a.sex=c.value);e.request("/social/register",a).then(function(a){b._owner.login()},function(a){b._error(a.response)})}})}},{key:"_error",value:function(a){h(a)}}]);return c}(b);l("RegisterScreen",d)}}});
System.register("view/tfa.js","./base.js ui/vcard.js ui/tfa.js util/keypair.js util/gettext.js conf.js util/net.js util/html.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g,c,a,b,f,d,n,p=function(){function a(a,
b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),q=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=
a["default"]},function(a){h=a["default"]},function(a){e=a["default"]},function(a){g=a["default"];c=a},function(b){a=b._},function(a){b=a["default"]},function(a){f=a},function(a){d=a}],execute:function(){n=function(k){function l(){if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");q(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,"tfa");this._helpVisible=!1;this._remember=this._node.querySelector(".remember");this._remember.classList.add("hidden")}m(l,
k);p(l,[{key:"activate",value:function(b){var f=this;q(Object.getPrototypeOf(l.prototype),"activate",this).call(this);document.title=a("tfa.title");c.isSupported().then(function(a){return f._keyPairSupported=a});var g=this._node.querySelector(".vcard-placeholder");d.clear(g);new h("",b.email,null,g);b.onAllow=function(a){return f._onAllow(a,b)};g=new e(b);this._node.querySelector(".tfa-placeholder").appendChild(g.getNode())}},{key:"_onAllow",value:function(a,c){var d=this;if(!this._keyPairSupported||
b.oauth)return c.onDone(a);this._remember.classList.remove("hidden");this._node.querySelector("[data-action=remember]").addEventListener("click",function(b){b.preventDefault();g.generate("").then(function(a){return d._saveKeyPair(a,c)}).then(function(){return c.onDone(a)})});this._node.querySelector("[data-action=continue]").addEventListener("click",function(b){b.preventDefault();c.onDone(a)})}},{key:"_saveKeyPair",value:function(a,b){var c=a.toString().then(function(a){try{localStorage.setItem("keypair-"+
b.email,a)}catch(w){}});a=a.exportPublic().then(function(a){return f.request("/2fa/browsers",{ua:navigator.userAgent,pubkey:a}).then(function(a){try{localStorage.setItem("browser_id-"+b.email,a.browser_id)}catch(B){}},function(a){})});return Promise.all([c,a])}}]);return l}(k);l("default",new n)}}});
System.register("view/veto-done.js",["./base.js","util/gettext.js","conf.js","app.js"],function(l){function m(e,g){if("function"!==typeof g&&null!==g)throw new TypeError("Super expression must either be null or a function, not "+typeof g);e.prototype=Object.create(g&&g.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});g&&(Object.setPrototypeOf?Object.setPrototypeOf(e,g):e.__proto__=g)}var k,h;return{setters:[function(e){k=e["default"]},function(e){},function(e){},function(e){}],
execute:function(){h=function(e){function g(){if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");a:{var c=Object.getPrototypeOf(g.prototype),a="constructor";var b=this;var e=!0;for(;e;)if(null===c&&(c=Function.prototype),e=Object.getOwnPropertyDescriptor(c,a),void 0===e){c=Object.getPrototypeOf(c);if(null===c)break;e=!0}else{if("value"in e){b=e.value;break a}a=e.get;b=void 0===a?void 0:a.call(b);break a}b=void 0}b.call(this,"veto-done")}m(g,e);return g}(k);l("default",
new h)}}});
System.register("view/veto.js","./base.js util/net.js app.js util/gettext.js util/error.js validators/base.js validators/passwordmatch.js validators/password.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}
var k,h,e,g,c,a,b,f,d,n=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),p=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:
b.call(c)}};return{setters:[function(a){k=a["default"]},function(a){h=a},function(a){e=a},function(a){g=a._},function(a){c=a["default"]},function(b){a=b["default"]},function(a){b=a["default"]},function(a){f=a["default"]}],execute:function(){d=function(d){function k(){if(!(this instanceof k))throw new TypeError("Cannot call a class as a function");p(Object.getPrototypeOf(k.prototype),"constructor",this).call(this,"veto");this._form=this._node.querySelector("form");this._form.addEventListener("submit",
this);this._passwords=Array.from(this._form.querySelectorAll("[type=password]"));this._validators={old:new a(this._passwords[0]),password:new f(this._passwords[1],conf.email),match:new b(this._passwords[2],this._passwords.slice(1))}}m(k,d);n(k,[{key:"activate",value:function(){p(Object.getPrototypeOf(k.prototype),"activate",this).call(this);document.title=g("veto.title")}},{key:"handleEvent",value:function(a){var b=this;a.preventDefault();a=Object.keys(this._validators).map(function(a){return b._validators[a].validate(!0)});
Promise.all(a).then(function(a){a.every(function(a){return a})&&(Object.keys(b._validators).forEach(function(a){return b._validators[a].hide()}),b._setPassword())})}},{key:"_setPassword",value:function(){var a=this,b={};Array.from(this._form.querySelectorAll("input")).forEach(function(a){b[a.name]=a.value});h.request("/veto",b,{method:"post"}).then(function(){return e.setView("veto-done")},function(b){return a._error(b)})}},{key:"_error",value:function(a){a instanceof h.HTTPError&&400==a.status&&
this._knownError(a.response.status)||c(a)}},{key:"_knownError",value:function(a){switch(a){case 401:this._validators.old.show(g("veto.validation.old"));break;case 456:this._validators.password.show(g("register.validation.password.many_changes"));break;case 492:this._validators.password.show(g("register.validation.password.historic"));break;case 493:this._validators.password.show(g("register.validation.password.similar"));break;case 496:this._validators.password.show(g("register.validation.password.weak"));
break;default:return!1}return!0}}]);return k}(k);l("default",new d)}}});
System.register("view/veto-pin.js","./base.js util/gettext.js util/net.js app.js util/error.js validators/base.js".split(" "),function(l){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k,h,e,g,c,a,b=function(){function a(a,b){for(var c=
0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};return{setters:[function(a){k=a["default"]},
function(a){h=a._},function(a){e=a},function(a){},function(a){g=a["default"]},function(a){c=a["default"]}],execute:function(){a=function(a){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");f(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,"veto-pin");this._form=this._node.querySelector("form");this._form.addEventListener("submit",this);this._validators={pin:new c(this._form.querySelector("[name=pin]")),email:new c(this._form.querySelector("[name=email]"))}}
m(d,a);b(d,[{key:"activate",value:function(){f(Object.getPrototypeOf(d.prototype),"activate",this).call(this);document.title=h("veto-pin.title")}},{key:"handleEvent",value:function(a){var b=this;a.preventDefault();a=Object.keys(this._validators).map(function(a){return b._validators[a].validate(!0)});Promise.all(a).then(function(a){a.every(function(a){return a})&&(Object.keys(b._validators).forEach(function(a){return b._validators[a].hide()}),b._submit())})}},{key:"_submit",value:function(){var a=
this,b={};Array.from(this._form.querySelectorAll("input")).forEach(function(a){b[a.name]=a.value});e.request("/veto/pin",b,{method:"post"}).then(function(a){return window.location=a.location},function(b){return a._error(b)})}},{key:"_error",value:function(a){a instanceof e.HTTPError&&400==a.status&&this._knownError(a.response.status)||g(a)}},{key:"_knownError",value:function(a){switch(a){case 452:this._validators.pin.show(h("veto-pin.error.too_many"));break;case 453:this._validators.pin.show(h("veto-pin.error.pin"));
break;case 454:this._validators.pin.show(h("veto-pin.error.expired"));break;default:return!1}return!0}}]);return d}(k);l("default",new a)}}});System.import("app.js").then(function(l){l.init(conf)}).catch(function(l){window.console&&console.error&&console.error(l)});
